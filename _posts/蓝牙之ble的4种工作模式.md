---
title: 蓝牙之ble的4种工作模式
date: 2019-03-29 14:33:32
tags:
	- 蓝牙

---

--

# ble的4种工作模式

BLE（Bluetooth Low Energy）有以下四种主要的工作模式：

1. **广播模式（Advertising Mode）**：
   - 设备以固定时间间隔发送广播包，用于宣传设备的存在和提供的服务。
   - 其他设备可以通过监听广播包来发现附近的BLE设备。
   - 广播模式下的设备通常不接受连接请求，只用于设备的发现。

2. **连接模式（Connection Mode）**：
   - 设备在广播模式下被发现后，可以建立连接以进行数据交换。
   - 连接模式下的设备可以发送和接收数据，并且具有较高的数据传输速率。
   - 连接模式下的设备通常使用GATT（Generic Attribute Profile）协议来管理连接和数据交换。

3. **扫描模式（Scanning Mode）**：
   - 设备可以进入扫描模式来搜索附近的广播设备。
   - 扫描模式下的设备通常不发送广播包，只监听其他设备的广播包，用于发现附近的BLE设备。

4. **监听模式（Observing Mode）**：
   - 设备可以进入监听模式来监听其他设备的广播包。
   - 监听模式下的设备通常不发送广播包，只监听其他设备的广播包，用于 passively 发现附近的BLE设备。

这四种工作模式在BLE设备的通信过程中扮演着不同的角色，使得BLE设备可以根据具体的应用需求和场景灵活地进行通信和交互。

# ble通信过程说明

BLE（Bluetooth Low Energy）通信过程涉及以下几个主要步骤：

1. **广播（Advertising）**：
   - 发送方设备以固定时间间隔发送广播包，其中包含设备的标识符和广播数据。
   - 广播包可以包含设备的名称、服务 UUID、厂商自定义数据等信息。
   - 接收方设备可以通过监听广播包来发现附近的BLE设备。

2. **扫描（Scanning）**：
   - 接收方设备进入扫描模式，主动搜索并监听附近的广播包。
   - 当接收到广播包时，扫描设备可以识别出附近的BLE设备，并获取其标识符和广播数据。

3. **连接建立（Connection Establishment）**：
   - 如果接收方设备对发送方设备感兴趣，可以发起连接请求，进入连接模式。
   - 发送方设备可以接受连接请求，建立连接。
   - 连接建立后，发送方设备和接收方设备之间可以进行数据交换。

4. **服务发现（Service Discovery）**：
   - 连接建立后，接收方设备可以发送服务发现请求，获取发送方设备支持的服务和特征。
   - 发送方设备回复服务发现响应，告知接收方设备支持的服务和特征。

5. **数据交换（Data Exchange）**：
   - 连接建立后，发送方设备和接收方设备之间可以进行数据交换。
   - 数据交换可以通过读写属性、通知、指示等方式进行。
   - 发送方设备可以发送数据给接收方设备，或者接收数据来自接收方设备。

6. **连接维持（Connection Maintenance）**：
   - 在连接建立后，设备之间可以保持连接一段时间，进行数据交换。
   - 发送方设备和接收方设备之间可以定期发送连接维持信号，以保持连接的稳定性。

以上是BLE通信过程的基本步骤，其中包括了设备的发现、连接建立、服务发现和数据交换等关键环节。具体的通信过程可能会根据设备的角色和应用场景有所不同，但通常遵循以上的基本流程。



# ble的广播包组成

BLE的广播包是一种特殊的数据包，用于在广播模式下向周围设备传输信息。

一个标准的BLE广播包通常由以下几个部分组成：

1. **Preamble（前导码）**：
   - 前导码是一个固定模式的序列，用于同步接收方设备的时钟。

2. **Access Address（访问地址）**：
   - 访问地址是一个32位的随机值，用于标识BLE数据包的开始位置，并将其与其他无关的无线信号区分开来。

3. **Header（头部）**：
   - 头部包含两个字节，其中包括了广播数据的类型（AdvA）和广播数据的长度（AdvLength）。
   - AdvA是发送设备的蓝牙地址，用于识别发送方设备。
   - AdvLength表示广播数据的长度，即广播数据部分的字节数。

4. **广播数据（Advertise Data）**：
   - 广播数据是包含实际传输信息的部分，长度可以根据需要进行设置。
   - 广播数据的内容可以是设备名称、服务 UUID、厂商自定义数据等。

5. **CRC（循环冗余校验）**：
   - CRC是一个3字节的循环冗余校验码，用于检测数据传输过程中的错误和丢失。

以上是一个标准的BLE广播包的组成部分。广播包的内容和长度可以根据具体的需求进行定制和设置，以满足不同的应用场景和需求。

## 给出一个实际的包分析

好的，下面是一个实际的BLE广播包的分析示例：

```
Packet Type: Adv Nonconn Ind (0x13)
Address: 00:1A:7D:DA:71:13 (Random)
Adv Data Length: 10 bytes
    Flags: 0x06 (LE General Discoverable Mode, BR/EDR Not Supported)
    Complete Local Name: 'MyDevice'
    Service UUIDs: 00001800-0000-1000-8000-00805F9B34FB
RSSI: -75 dBm
```

在这个示例中，我们分析了一个BLE广播包的内容：

- **Packet Type（包类型）**：这个包的类型是Adv Nonconn Ind，表示这是一个非连接广播包，用于向周围设备广播信息。
- **Address（地址）**：发送这个广播包的设备地址是00:1A:7D:DA:71:13。
- **Adv Data Length（广播数据长度）**：广播数据部分的长度是10字节。
- **Flags（标志）**：标志字段指示了设备的一些状态，比如LE General Discoverable Mode表示设备处于LE（Low Energy）通用可发现模式，BR/EDR Not Supported表示设备不支持传统的BR/EDR模式。
- **Complete Local Name（完整本地名称）**：这个字段包含设备的名称，这个设备的名称是'MyDevice'。
- **Service UUIDs（服务UUID）**：这个字段包含了设备支持的服务UUID，这里是一个标准的UUID，代表了一个通用的服务。
- **RSSI（接收信号强度指示）**：RSSI字段表示接收到这个广播包时的信号强度，这里是-75 dBm。

以上是一个实际的BLE广播包的分析示例，通过分析广播包的内容，可以了解设备的状态、名称和支持的服务等信息。

# ble通信的拓扑模型

BLE（Bluetooth Low Energy）通信的拓扑模型通常是星型或者网状型的，

具体取决于设备的角色和通信方式。

以下是两种常见的BLE通信拓扑模型：

1. **星型拓扑模型**：
   - 在星型拓扑中，一个中心设备（Central）控制多个外围设备（Peripheral）。
   - 中心设备负责管理连接和数据交换，外围设备被动响应中心设备的请求。
   - 这种模型常用于BLE连接模式下，其中一个中心设备可以同时连接多个外围设备，进行数据传输和控制。

2. **网状拓扑模型**：
   - 在网状拓扑中，多个设备可以相互连接，形成一个网络结构。
   - 每个设备既可以充当中心设备，也可以充当外围设备，具有相互连接的能力。
   - 这种模型常用于BLE广播模式下，其中设备可以相互发现和连接，形成一个相互连接的网络。

除了上述的星型和网状拓扑模型之外，BLE通信还可以采用集中式或分散式的模型。在集中式模型中，一个中心设备集中管理多个外围设备，而在分散式模型中，每个设备都可以相互连接，没有中心设备的概念。

总的来说，BLE通信的拓扑模型可以根据具体的应用场景和需求进行选择和配置，以满足不同设备之间的连接和通信需求。

## ble星型拓扑结构的现实使用场景分析

BLE星型拓扑结构在实际应用中具有多种使用场景，以下是一些常见的例子：

1. **智能家居**：在智能家居系统中，一个中心设备（比如智能手机、智能音箱或者智能网关）可以充当控制中心，管理多个外围设备（比如智能灯泡、智能插座、智能传感器等）。中心设备可以通过BLE连接控制各个外围设备，实现智能家居设备的集中控制和管理。

2. **健康监测**：在健康监测领域，一些健康设备（比如智能手环、智能手表、体重秤等）可以与智能手机或者健康监测器连接，形成一个BLE星型拓扑结构。智能手机作为中心设备，可以管理多个外围设备，实时监测用户的健康数据，并进行数据分析和记录。

3. **工业物联网**：在工业物联网领域，一些传感器和控制设备可以与中心设备（比如工业控制器或者监控终端）连接，形成一个BLE星型拓扑结构。中心设备可以监控和控制各个外围设备，实现工业生产过程的监控和调控。

4. **零售和商业**：在零售和商业领域，一些商业设备（比如智能收银机、智能展示柜、智能标签等）可以与中心设备（比如商家的POS系统或者管理终端）连接，形成一个BLE星型拓扑结构。中心设备可以管理和控制各个外围设备，实现商业业务的管理和运营。

总的来说，BLE星型拓扑结构在各种应用场景中都具有重要的作用，它可以实现设备之间的连接和通信，提高系统的灵活性和可扩展性，同时也可以实现集中控制和管理，提高系统的智能化和效率。

# ble智能网关

BLE智能网关是一种设备，通常用于连接和管理多个BLE外围设备，并与其他网络（比如Wi-Fi、以太网）进行通信。它在BLE星型拓扑结构中扮演着中心设备的角色，负责管理和控制多个外围设备，同时也可以实现与其他网络的互联互通。

以下是BLE智能网关的一些特点和功能：

1. **连接管理**：BLE智能网关可以同时连接和管理多个BLE外围设备，实现设备之间的数据交换和通信。

2. **数据转发**：BLE智能网关可以将从BLE外围设备接收到的数据转发到其他网络（比如Wi-Fi、以太网），或者将其他网络的数据转发到BLE外围设备。

3. **协议转换**：BLE智能网关可以实现不同通信协议之间的转换和适配，比如将BLE数据转换为HTTP、MQTT等标准协议，实现与云端服务器的通信。

4. **远程控制**：通过与其他网络的连接，BLE智能网关可以实现远程控制和管理，用户可以通过手机App或者Web界面远程监控和控制BLE外围设备。

5. **数据处理**：BLE智能网关可以对从BLE外围设备接收到的数据进行处理和分析，比如数据存储、数据分析、报警处理等。

6. **安全性**：BLE智能网关可以实现数据加密和认证，确保通信过程中的数据安全性和隐私保护。

总的来说，BLE智能网关在物联网应用中具有重要作用，它可以实现BLE设备与互联网的连接和通信，为用户提供更便捷、智能和安全的物联网服务。



http://www.jinoux.com/ble_5_0_smart_gateway.html

# 树莓派实现ble智能网关

https://blog.csdn.net/qq_33475105/article/details/115415570

# 参考资料

1、干货总结：Ble低功耗蓝牙常见的4种工作模式

https://www.jianshu.com/p/f9a681c78bd0