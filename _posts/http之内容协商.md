---
title: http之内容协商
date: 2021-11-26 15:16:33
tags:
	- http

---

--

一个URL常常需要代表若干不同的资源。

例如那种需要以多种语言提供其内容的网站站点。

如果某个站点有说法语的和说英语的两种用户，

它可能想用这两种语言提供网站站点信息。

理想情况下，

服务器应当向英语用户发送英文版，

向法语用户发送法文版——用户只要访问网站主页就可以得到相应语言的内容。



HTTP提供了内容协商方法，允许客户端和服务器作这样的决定。

通过这些方法，单一的URL就可以代表不同的资源（比如，同一个网站页面的法语版和英语版），这些不同的版本称为变体。

本文将详细介绍内容协商。



我们在日常的抓包过程中经常可以看到以Accept开头的请求首部，

比如：Accept-Language 有一个q值，

肯定有人好奇在HTTP规范中为什么要定义这个q值；

还有在响应首部有一个名为Vary的首部，这个首部又有什么意义？

如图所示：



要讲清楚这两个问题，我们需要引入HTTP协议的内容协商概念：

某一资源，服务器有多个版本，

客户端告知服务器自己的偏好，服务器根据偏好选择合适的版本响应客户端的请求。



  共有3种不同的方法可以决定服务器上哪个页面最适合客户端：

**让客户端来选择、**

**服务器自动判定、**

**让中间代理来选。**

**这3种技术分别称为客户端驱动的协商、服务器驱动的协商以及透明协商。**



其中，服务器驱动的解决方案应用的较为广泛。 

服务器检查客户端的请求首部集并决定提供哪个版本的页面。
  优点：比客户端驱动的协商要快。HTTP提供了q机制，允许服务器近似匹配，还提供了vary首部供服务器告知下游的设备（如代理服务器）如何对请求估值；
  缺点：首部集不匹配，服务器要做猜测；



客户端可以用下面列出的HTTP首部集发送用户的偏好信息：

> Accept：告知服务器发送何种媒体类型；
> Accept-Language：告知服务器发送何种语言；
> Accept-Charset：告知服务器发送何种字符集；
> Accept-Encoding：告知服务器采用何种编码；



  服务器用下面列出的实体首部集来匹配客户端的Accept首部集：

> Accept首部  　　   实体首部
> Accept  　　　　　 Content-Type
> Accept-Language   Content-Language
> Accept-Charset    Content-Type
> Accept-Encoding   Content-Encoding



参考资料

1、

https://www.cnblogs.com/supersnowyao/p/8593828.html

