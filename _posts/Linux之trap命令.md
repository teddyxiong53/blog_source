---
title: Linux之trap命令
date: 2023-06-19 17:15:11
tags:
	- Linux
---

--

# trap - INT QUIT TSTP命令解释

`trap` 命令用于在 Shell 脚本中设置和处理信号。在给定的代码块中使用 `trap` 命令，可以定义对指定信号的响应操作。

在你提供的例子中，`trap - INT QUIT TSTP` 的含义如下：

- `-` 表示取消对指定信号的默认处理方式。
- `INT` 表示中断信号（通常由用户按下 Ctrl+C 产生）。
- `QUIT` 表示退出信号（通常由用户按下 Ctrl+\ 产生）。
- `TSTP` 表示停止信号（通常由用户按下 Ctrl+Z 产生）。

通过执行 `trap - INT QUIT TSTP`，**你取消了对这三个信号的默认处理方式**，即使收到这些信号，脚本不会立即终止或退出，也不会被停止。

在 Shell 脚本中，你可以结合 `trap` 命令和函数来处理信号，执行一些特定的操作，例如清理资源、保存状态或执行其他自定义逻辑。下面是一个示例：

```shell
#!/bin/bash

cleanup() {
  echo "Cleaning up..."
  # 执行清理操作
  # ...
  exit 0
}

# 设置信号处理函数
trap cleanup INT QUIT TSTP

# 正常的脚本逻辑
echo "Running script..."
# ...
# ...
```

在上面的示例中，当脚本收到中断、退出或停止信号时，会执行 `cleanup` 函数来进行清理操作，并最终退出脚本。

# 解释这个脚本

```
  (
		trap - INT QUIT TSTP
		set start
		. $i
	    ) 
```

这段脚本使用了子shell `( ... )` 和 `trap` 命令来设置信号处理，并执行指定的脚本。

具体解释如下：

1. `( ... )` 是一个子shell，用于创建一个独立的子shell环境，其中的命令将在子shell中执行。**这样做的目的是为了在子shell中设置信号处理，以防止信号影响到主脚本。**

2. `trap - INT QUIT TSTP` 取消对中断、退出和停止信号的默认处理方式。这意味着当子shell接收到这些信号时，它们不会立即终止子shell，也不会退出或停止执行。

3. `set start` 设置一个名为 "start" 的参数。这可能是为了将某个标志或参数传递给脚本的一部分，以便脚本可以根据需要进行处理。

4. `. $i` 使用点号 (`.`) 来执行 `$i` 变量所代表的脚本文件。点号 (`.`) 是 Shell 中的内置命令，用于在当前 Shell 环境中执行指定的脚本，而不是启动一个新的 Shell 进程。通过这种方式执行的脚本可以访问当前 Shell 环境中的变量和函数。

总结起来，这段脚本的目的是在子shell中执行 `$i` 变量所代表的脚本，并设置特定的信号处理方式。在执行脚本之前，取消了中断、退出和停止信号的默认处理。执行脚本时，可能会使用 "start" 参数来影响脚本的行为。

希望以上解释对你有所帮助！如果还有其他问题，请随时提问。

