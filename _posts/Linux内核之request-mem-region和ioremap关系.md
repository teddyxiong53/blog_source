---
title: Linux内核之request_mem_region和ioremap关系
date: 2017-08-27 21:20:08
tags:
	- kernel

---

几乎每一种外设都是通过读写设备上的寄存器来进行工作的。

而寄存器一般包括：控制、状态、数据这3种。


其实说白了，request_mem_region函数并没有做实际性的映射工作，只是告诉内核要使用一块内存地址，声明占有，也方便内核管理这些资源。



重要的还是ioremap函数，ioremap主要是检查传入地址的合法性，建立页表（包括访问权限），完成物理地址到虚拟地址的转换。



## ioremap和phys_to_virt区别

1、ioremap时用来实现物理地址到虚拟地址的动态重映射的，常使用在映射CPU外围控制器的地址。对于soc，一般是操作寄存器的。

2、而phys_to_virt时将已经映射的物理内存的地址转换为虚拟地址。操作的是DDR内存的地址范围。

3、一般我们写驱动都是用ioremap。

