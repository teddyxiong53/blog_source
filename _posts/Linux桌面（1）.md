---
title: Linux桌面（1）
date: 2024-04-25 10:02:17
tags:
	- Linux

---

--

# 基本概念

Linux桌面先要搞清楚几个基本概念。

http://www.smth.org/posts/dm_de_wm/

## DM

操作系统的图形环境只是方便用户使用，不应该太过重量级喧宾夺主，所以DM(Display Manager)用LightDM，只是管理用户登录嘛，要那么复杂干嘛？

### lightdm

https://wiki.archlinux.org/title/LightDM

https://github.com/canonical/lightdm

LightDM（Lightweight Display Manager）是一个用于**管理登录会话**的显示管理器。

它是一个跨平台的显示管理器，旨在轻量、快速、易于配置和定制。

LightDM的设计使得它可以很容易地与各种不同的桌面环境和窗口管理器配合使用，

包括但不限于GNOME、KDE、Xfce等。

它提供了一个简单的用户界面，允许用户选择他们想要登录的帐户，并且可以通过主题和插件进行自定义。LightDM还支持自动登录、会话管理以及其他一些高级功能，使其成为许多Linux发行版默认的显示管理器之一。

## DE

缺省桌面环境(DE)选的是Xfce4，因为它是轻量的，但又不是特别轻量的。桌面环境只是个支撑，目的是方便运行其他程序，为什么要用重磅的KDE或Gnome呢？Xfce桌面只占用少量内存就无比强大，稳定、简单优雅、可配置性强、模块化。

## WM

但是我以前常用的并不是Xfce4，而是i3wm。但登录后i3wm是一片空白，如果不知道快捷键甚至不知道如何操作。既然是一个发行版，不能让没用过i3wm的不知从何入手。

但瓦片式WM的方便性确实让人着迷，虽然Xfwm4也可以用快捷键把应用窗口左右/上下二分，或者四分，但还是不够爽，无法同时看到5个以上的窗口。所以决定把Xfce4和瓦片式WM结合起来，用bspwm代替Xfwm4，这就形成了上面有菜单条状态条、主界面是bspwm瓦片式的情况，不知道快捷键的人可以从菜单执行程序，又能得到瓦片式WM的便捷性。

之所以用bspwm而不是i3wm，是使用中觉得bspwm和Xfce4的结合更好、更方便。

### Ulauncher

GUI操作环境一个最重要的作用就是方便用户找到需要的程序执行，

Xfce4+bspwm 可以从程序菜单树找到程序执行，也可以设定快捷键直接执行。

但macOS的Spotlight是一个非常方便的入口，只要知道要执行的程序的名字，甚至部分，也可以方便地找到执行。

所以用上Ulauncher，连快捷键定义也跟macOS一样，Super+空格。

当然，经常跟i3wm配合使用的dmenu、Rofi等，不过我最喜欢Ulauncher。

## DM和WM的关系

显示管理器（Display Manager，DM）和窗口管理器（Window Manager，WM）是两个不同但相关的概念，它们在桌面环境中扮演着不同的角色。

1. **显示管理器（Display Manager，DM）**：
   - 显示管理器是用于管理用户登录会话的组件。它提供了一个登录界面，允许用户输入凭据并选择桌面环境或会话类型。显示管理器通常显示在屏幕上，并等待用户输入用户名和密码以启动桌面会话。
   - 例如，LightDM、GDM（GNOME Display Manager）、SDDM（Simple Desktop Display Manager）等都是常见的显示管理器。

2. **窗口管理器（Window Manager，WM）**：
   - 窗口管理器**控制着桌面上窗口的外观和行为**。它们负责绘制窗口边框、标题栏和窗口按钮，并处理窗口的移动、调整大小、最小化和关闭等操作。
   - 一些窗口管理器还提供了虚拟桌面、窗口装饰、窗口焦点控制等功能。
   - 一些流行的窗口管理器包括：GNOME Shell（Mutter）、KDE Plasma（KWin）、**Xfce4窗口管理器（Xfwm）**、Openbox、i3等。

关系：
- 显示管理器和窗口管理器之间是一种上下级的关系。当用户在显示管理器中登录后，显示管理器负责启动桌面环境，并在用户桌面上启动适当的窗口管理器。
- 一般情况下，用户可以自由选择显示管理器和窗口管理器，以满足他们的需求和偏好。例如，您可以使用LightDM作为显示管理器，并选择使用GNOME Shell（Mutter）或Openbox作为窗口管理器。

# lightdm

## lightdm的代码结构说明

LightDM 的代码结构相对清晰，主要分为以下几个部分：

1. **核心功能模块**：
   - 这部分包含了 LightDM 的核心功能，如用户会话管理、显示器管理、认证等。这些功能通常由一组核心文件和模块来实现，例如用于用户会话管理的 session.c、用于显示器管理的 display.c 等。

2. **前端界面**：
   - LightDM 提供了不同的前端界面，用于用户与登录系统进行交互。这些界面通常位于 `data/` 目录下，包括 GTK+ 前端、Qt 前端等。这些界面的代码主要负责显示登录界面、处理用户输入、与核心功能模块交互等。

3. **主题和样式**：
   - LightDM 支持通过主题来定制登录界面的外观和样式。主题通常包含了界面布局、图标、背景等元素。主题相关的文件位于 `data/themes/` 目录下。

4. **插件系统**：
   - LightDM 提供了一个插件系统，允许开发者通过插件来扩展其功能。插件可以用于实现不同的认证方式、自定义会话管理逻辑等。插件代码通常位于 `lightdm/` 目录下。

5. **配置文件和脚本**：
   - LightDM 的配置文件通常位于 `/etc/lightdm/lightdm.conf` 或 `/etc/lightdm/lightdm.conf.d/` 中，用于配置各种选项和参数。此外，还可能包含一些启动脚本、初始化脚本等。

6. **测试和文档**：
   - LightDM 的代码库通常包含一些测试代码，用于测试核心功能的正确性和稳定性。此外，还可能包含一些文档和说明文件，用于指导开发者如何使用和定制 LightDM。

总体来说，LightDM 的代码结构相对简单明了，易于理解和定制。通过阅读代码和文档，开发者可以很容易地了解其工作原理，并根据需要进行定制和扩展。

# Linux桌面系统里，谁控制了framebuffer

在Linux桌面系统中，Frame Buffer 是一个在内核层面提供图形显示的设备。在典型的 Linux 桌面系统中，Framebuffer 的控制主要由以下两个部分负责：

1. **内核驱动程序**：
   - Linux 内核提供了对不同硬件平台上 Frame Buffer 设备的支持，这些支持通常以设备驱动程序的形式提供。这些驱动程序负责初始化 Frame Buffer 设备，并提供操作 Frame Buffer 的接口，使得用户空间程序可以通过标准的系统调用来操作 Frame Buffer。
   - 这些驱动程序通常被编译进 Linux 内核本身，或者作为模块动态加载到内核中。它们负责与硬件交互，管理显示缓冲区，并提供一组接口供用户空间程序使用。

2. **用户空间程序**：
   - 在 Linux 桌面系统中，**用户空间的图形显示通常由图形服务器（如 Xorg 或 Wayland）来管理。**这些图形服务器通过 Frame Buffer 设备来实现图形显示，它们会与 Frame Buffer 设备的内核驱动程序进行交互，以在屏幕上绘制图形界面。
   - Xorg 是传统的 Linux 图形服务器，它使用 Frame Buffer 设备通过设备无关的接口（如 DDX 驱动）来操作图形硬件。
   - Wayland 是一种新型的图形显示协议，它更加现代化和高效，直接利用 Frame Buffer 设备提供图形显示，不需要额外的硬件抽象层。

综上所述，Linux 桌面系统中，Frame Buffer 的控制主要由内核驱动程序和用户空间图形服务器共同负责。内核驱动程序负责与硬件交互，提供 Frame Buffer 设备的接口，而用户空间图形服务器则利用这些接口来实现图形显示。

# i3wm如何跟x server交互

在 Linux 桌面环境中，i3wm 与 X Server 之间的交互**主要通过 X Window System 协议来实现**。X Window System 是一个用于图形用户界面的标准协议，它定义了客户端和服务器之间的通信方式，使得客户端程序可以向服务器发送绘图请求，并接收来自服务器的输入事件。

具体来说，i3wm 作为一个窗口管理器（WM），它利用 X Window System 提供的接口与 X Server 进行交互，实现了以下几个方面的功能：

1. **窗口管理**：
   - i3wm 接收来自 X Server 的窗口创建、移动、调整大小等事件，并根据用户配置的规则和策略进行相应的处理。它通过 X Window System 提供的接口来管理窗口的布局、层叠、焦点等。

2. **绘图请求**：
   - 当 i3wm 需要绘制窗口边框、标题栏、工作区等元素时，它会向 X Server 发送绘图请求。X Server 接收到这些请求后，负责在屏幕上进行绘制，并将结果反馈给 i3wm。

3. **输入事件处理**：
   - i3wm 接收来自 X Server 的用户输入事件，如鼠标点击、键盘输入等，并根据当前的布局和焦点状态进行相应的处理。它通过 X Window System 提供的接口来监听和处理这些输入事件。

4. **通信协议**：
   - i3wm 和 X Server 之间的通信基于 X Window System 协议，这是一种客户端-服务器模型的通信协议。i3wm 作为 X 客户端向 X Server 发送请求，而 X Server 则作为 X 服务器接收并处理这些请求。

总的来说，i3wm 通过 X Window System 提供的接口与 X Server 进行交互，实现了窗口管理、绘图请求处理、输入事件处理等功能，从而实现了一个基于 X Window System 的轻量级窗口管理器。

