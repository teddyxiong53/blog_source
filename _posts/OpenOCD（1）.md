---
title: OpenOCD（1）
date: 2023-08-24 15:37:33
tags:
	- 单片机

---

--

# 介绍

OpenOCD（Open On-Chip Debugger）是一个开源的硬件调试和编程工具，

它用于与嵌入式系统中的微控制器和处理器进行通信、调试和编程。

OpenOCD支持多种调试适配器和目标设备，

使开发人员能够在嵌入式系统上执行多种调试任务。

以下是OpenOCD的一些主要特点和功能：

1. **跨平台支持**：OpenOCD是一个跨平台的工具，可在各种操作系统上运行，包括Linux、Windows和macOS。

2. **多种调试适配器支持**：OpenOCD支持多种调试适配器，包括JTAG适配器和SWD适配器，使其能够与不同类型的目标设备兼容。

3. **多种目标设备支持**：OpenOCD支持多种处理器架构和目标设备，包括ARM、MIPS、RISC-V等，使其适用于各种嵌入式系统。

4. **调试功能**：OpenOCD提供了丰富的调试功能，包括单步执行、断点设置、查看寄存器和内存内容、监视变量等。

5. **目标设备编程**：除了调试，OpenOCD还支持目标设备的编程功能，可用于烧写闪存、EEPROM等。

6. **脚本支持**：OpenOCD允许使用脚本来自动化和定制调试和编程任务。

7. **GDB集成**：OpenOCD可以与GNU调试器（GDB）集成，使开发人员能够使用GDB与目标设备进行交互。

8. **自定义配置**：用户可以创建自定义配置文件，以指定连接的硬件、目标设备类型和其他参数。

9. **开源和社区支持**：OpenOCD是开源的，拥有庞大的用户和开发社区，提供了丰富的文档、示例和支持资源。

OpenOCD通常用于嵌入式系统开发，特别是在裸机编程、嵌入式固件开发和调试方面。它是一个功能强大的工具，可以帮助开发人员解决嵌入式系统中的问题，并加速嵌入式应用程序的开发和调试过程。如果您需要进行嵌入式系统开发，特别是与微控制器或处理器相关的开发和调试工作，OpenOCD可能是一个非常有用的工具。

## jtag适配器和swd适配器区别

JTAG适配器（Joint Test Action Group适配器）和SWD适配器（Serial Wire Debug适配器）都是用于连接到嵌入式系统的调试接口，以便进行调试和编程的硬件设备。它们之间的主要区别在于通信协议和用途：

1. **JTAG适配器**：

   - **通信协议**：JTAG适配器使用JTAG通信协议。JTAG（也称为IEEE 1149.1）是一种硬件调试和测试接口标准，通常使用一组引脚（TCK、TMS、TDI、TDO等）与目标设备通信。
   
   - **用途**：JTAG适配器通常用于提供对嵌入式系统中的JTAG接口的访问。JTAG接口在芯片级别上提供了硬件级别的访问，可用于调试、测试和编程目标设备。它通常用于更复杂的嵌入式系统和FPGA（现场可编程门阵列）的调试和测试。

   - **支持设备**：JTAG适配器通常适用于各种处理器架构和芯片类型，包括ARM、MIPS、PowerPC等。

2. **SWD适配器**：

   - **通信协议**：SWD适配器使用Serial Wire Debug（SWD）通信协议。SWD是一种针对ARM Cortex微控制器的低速、高效的调试接口，通常使用两根引脚（SWDIO和SWDCLK）进行通信。
   
   - **用途**：SWD适配器专门用于与支持SWD接口的ARM Cortex微控制器进行通信。它通常用于嵌入式系统中的微控制器调试和编程，因为许多现代嵌入式系统采用了ARM Cortex处理器。

   - **支持设备**：SWD适配器主要适用于支持ARM Cortex架构的微控制器和处理器。



| 特点                 | 描述                                                         |
| -------------------- | ------------------------------------------------------------ |
| **开源性**           | OpenOCD 是一个开源项目，可免费使用和修改。它的源代码可在 GitHub 上获取。 |
| **支持多种调试接口** | OpenOCD 支持多种调试接口，包括 JTAG、SWD（Serial Wire Debug）、CMSIS-DAP 等。这使得它可以与多种调试工具和设备配合使用。 |
| **跨平台**           | OpenOCD 可以在多种操作系统上运行，包括 Linux、Windows 和 macOS。这使得它成为一个跨平台的调试解决方案。 |
| **支持多种芯片架构** | OpenOCD 支持多种芯片架构，包括 ARM、RISC-V、MIPS 等。它可以与各种处理器内核和微控制器一起使用。 |
| **灵活性**           | OpenOCD 是一个灵活的工具，可以通过配置文件进行定制和扩展，以满足特定项目的需求。 |

总的来说，OpenOCD 是一个功能强大、灵活性高、开源且跨平台的调试工具，适用于嵌入式系统开发中的调试和烧录任务。

## JTAG通信协议

JTAG（Joint Test Action Group）通信协议是一种用于测试、调试和编程集成电路的标准通信协议。它最初是为了测试半导体器件的连接性而开发的，但后来被广泛用于调试和编程各种嵌入式系统和处理器。

JTAG通信协议的关键要点包括以下内容：

1. **引脚定义**：JTAG接口通常使用4至5个引脚，其中包括：
   - TCK（Test Clock）：测试时钟，用于时钟同步数据传输。
   - TMS（Test Mode Select）：测试模式选择，用于控制JTAG状态机的状态。
   - TDI（Test Data In）：测试数据输入，用于将数据输入目标设备。
   - TDO（Test Data Out）：测试数据输出，用于从目标设备读取数据。
   - TRST（Test Reset）（可选）：测试复位，用于复位JTAG链中的设备。

2. **状态机**：JTAG协议使用状态机来控制通信流程。状态机具有多个状态，包括Test-Logic-Reset（TLR）状态、Run-Test/Idle（RTI）状态和其他测试模式状态。通过控制TMS引脚，可以切换状态机的状态。

3. **数据传输**：在JTAG链中的设备之间进行数据传输时，数据通过TDO和TDI引脚进行传递。TCK引脚提供时钟信号，用于同步传输。

4. **调试和编程**：除了用于测试连接性，JTAG还用于调试和编程目标设备。通过JTAG接口，可以访问目标设备的内部状态、寄存器和存储器，并执行调试操作，如单步执行、断点设置等。

5. **支持设备**：JTAG协议广泛用于各种不同类型的集成电路和处理器，包括FPGA、微控制器、处理器、SoC（系统芯片）等。支持JTAG的设备通常具有JTAG接口。

6. **应用领域**：JTAG在嵌入式系统开发中非常常见，用于调试嵌入式软件和硬件。它还可用于芯片生产测试，以验证设备的连接性和功能。

7. **标准化**：JTAG协议的标准化由IEEE 1149.1定义，通常称为“JTAG标准”。此外，还有其他扩展和变种，如IEEE 1149.6（针对多核处理器的扩展）和IEEE 1149.7（降低JTAG接口引脚数量的小型标准）等。

总的来说，JTAG通信协议是一种重要的硬件调试和测试标准，用于测试、调试和编程集成电路和嵌入式系统。它是嵌入式系统开发和芯片生产测试的关键工具之一。

# 单片机断点调试的原理是什么

单片机（微控制器）断点调试是一种常见的嵌入式系统调试技术，用于在程序执行期间暂停执行，以便开发人员可以检查和修改代码、观察寄存器状态和内存内容。下面是单片机断点调试的一般原理：

1. **断点设置**：开发人员通过调试工具（如集成开发环境或调试器）指定程序中的一个或多个断点位置。断点可以是代码行、函数、地址或特定事件，如某个变量的值达到某个条件。这些断点用于标识程序执行中的暂停点。

2. **调试器连接**：单片机需要与调试工具（通常是一个调试器）连接，以允许远程控制和监视目标设备。连接通常通过JTAG、SWD或其他调试接口实现。

3. **监视程序执行**：调试工具通过与目标单片机通信来监视程序的执行。这包括跟踪程序计数器（PC）的值、监视寄存器状态和执行指令。

4. **触发断点**：当程序执行到一个断点时，调试工具将发出暂停执行的信号。这可以通过向单片机发送特定的调试命令来实现。一旦程序被暂停，单片机的CPU停止执行指令。

5. **检查状态和内存**：在断点处，开发人员可以检查单片机的状态，包括寄存器的值和内存内容。这有助于了解程序的执行情况和问题的原因。

6. **单步执行**：开发人员可以选择单步执行程序，逐条执行指令，以观察程序的行为。这对于发现逻辑错误和程序流程问题非常有用。

7. **修改代码**：在断点处，开发人员还可以修改程序的代码。这允许他们进行实时调试，例如修复bug并重新测试。

8. **继续执行**：一旦开发人员完成了调试操作，他们可以选择继续执行程序，直到下一个断点或程序结束。

总的来说，单片机断点调试允许开发人员在程序执行期间以非常精细的方式控制和观察程序的行为。这对于诊断和修复嵌入式系统中的问题非常重要，特别是当问题难以复现或需要实时反馈时。调试器和调试工具的功能会因厂商和型号而异，但通常提供了类似的调试功能，以简化嵌入式系统的开发和维护。



# SWD适配器

STM32开发板如何利落地连接外部编程器？从0设计一款SWD适配器

https://blog.51cto.com/u_15057820/2566505



# 单片机一般有哪些烧录方式

单片机通常有多种烧录方式，这些方式取决于单片机的类型、制造商以及支持的编程接口。以下是一些常见的单片机烧录方式：

1. **串口烧录**：串口烧录是通过串行通信接口（如UART或USART）将程序加载到单片机中的一种方式。这通常需要特殊的串口编程硬件，如USB串口转UART模块，以连接计算机和单片机。

2. **SPI 烧录**：SPI（Serial Peripheral Interface）是一种串行通信协议，可以用于将程序加载到支持SPI接口的单片机中。通常需要一个SPI编程器或USB-SPI转换器来执行此操作。

3. **I2C 烧录**：I2C（Inter-Integrated Circuit）是另一种串行通信协议，可用于加载程序到支持I2C接口的单片机中。与SPI类似，通常需要一个I2C编程器来执行此操作。

4. **JTAG/SWD 烧录**：JTAG（Joint Test Action Group）和SWD（Serial Wire Debug）是用于嵌入式系统调试的通信接口，也可以用于加载程序到支持这些接口的单片机中。通常需要专用的JTAG编程器或SWD编程器。

5. **ICSP 烧录**：ICSP（In-Circuit Serial Programming）是一种在单片机电路板上的集成编程方式。通常需要使用特殊的ICSP编程器或调试器，将编程器与目标单片机的编程引脚连接在一起。

6. **Bootloader 烧录**：某些单片机具有内置的引导加载程序（Bootloader），允许通过通信接口（例如串口或USB）加载程序。您可以通过特定的命令或过程来启动引导加载程序，然后通过所选的接口进行程序加载。

7. **并行烧录**：一些较老的单片机支持并行编程方式，通过并行编程器将程序并行加载到单片机的闪存或EPROM中。

8. **无线烧录**：某些嵌入式系统支持通过无线通信方式（例如Wi-Fi、Bluetooth）加载程序到单片机中。

请注意，烧录方式取决于单片机型号和制造商。在选择烧录方式之前，您需要确定您的目标单片机支持哪种方式，并相应地准备编程硬件和软件。此外，一些单片机可能需要在电路板上设置特殊的引脚或跳线，以启用编程模式。最好查看相关的单片机数据手册和编程工具文档，以获取详细的烧录指南。

# 单片机使用bootloader的方案

