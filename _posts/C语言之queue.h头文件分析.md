---
title: C语言之queue.h头文件分析
date: 2024-08-14 15:29:33
tags:
	- 数据结构

---

--

queue.h比较著名的有：

* Ben Noordhuis 的queue.h头文件说明
* BSD的sys/queue.h

# Ben Noordhuis 的queue.h头文件说明

`queue.h` 是由 Ben Noordhuis 编写的一个轻量级的宏定义库，主要用于处理C语言中的链表和队列数据结构。它类似于BSD系统中的 `sys/queue.h`，但更简洁，并且只包含最基础的功能。

以下是 `queue.h` 中一些关键宏的说明：

| 宏                                      | 说明                                                         |
| --------------------------------------- | ------------------------------------------------------------ |
| **QUEUE_HEAD(name, type)**              | 定义一个队列头部结构体，`name` 是队列的名称，`type` 是队列中元素的类型。 |
| **QUEUE_ENTRY(type)**                   | 定义一个队列元素结构体，用于表示元素之间的连接。             |
| **QUEUE_INIT(head)**                    | 初始化队列头部，将队列设为空。                               |
| **QUEUE_INSERT_HEAD(head, elm, field)** | 将一个元素插入到队列的头部。                                 |
| **QUEUE_INSERT_TAIL(head, elm, field)** | 将一个元素插入到队列的尾部。                                 |
| **QUEUE_REMOVE(head, elm, field)**      | 从队列中删除指定的元素。                                     |
| **QUEUE_FOREACH(var, head, field)**     | 遍历队列中的每一个元素。                                     |
| **QUEUE_EMPTY(head)**                   | 判断队列是否为空。                                           |
| **QUEUE_FIRST(head)**                   | 获取队列中的第一个元素。                                     |
| **QUEUE_NEXT(elm, field)**              | 获取队列中某个元素的下一个元素。                             |

`queue.h` 的设计目标是尽量简洁和高效，并且不依赖任何特定的系统库。它适用于需要简单队列或链表操作的项目。

这个头文件常用于一些轻量级项目，如 `libuv` 和 `node.js` 中，它为 C 语言提供了方便的队列和链表操作功能，避免了繁琐的手动指针操作。

# BSD系统中的 sys/queue.h对比

`BSD` 系统中的 `sys/queue.h` 是一个功能强大的数据结构库，提供了多种队列和链表的数据结构和操作。而 `Ben Noordhuis` 的 `queue.h` 是一个更简洁、轻量的版本。以下是两者的对比：

| 特性               | `sys/queue.h`                                                | Ben Noordhuis 的 `queue.h`                           |
| ------------------ | ------------------------------------------------------------ | ---------------------------------------------------- |
| **支持的数据结构** | 提供多种数据结构，包括简单队列（STAILQ）、循环队列（CIRCLEQ）、双链表（LIST、TAILQ）等。 | 仅提供单一的双向链表/队列实现。                      |
| **代码复杂度**     | 功能全面，代码较为复杂，支持多种操作和数据结构。             | 设计简洁，功能专注于基本的双向链表/队列操作。        |
| **依赖性**         | 依赖于BSD系统环境，但在其他系统上也可以移植使用。            | 无特定依赖，可以在任意C语言项目中使用。              |
| **操作宏**         | 提供大量宏用于插入、删除、遍历等操作，覆盖了多种队列和链表结构。 | 提供基本的插入、删除、遍历操作宏，足够应对常见场景。 |
| **用途**           | 适用于复杂项目，需要多种链表和队列结构时使用。               | 适用于轻量级项目，只需基本队列/链表操作时使用。      |

### 总结
- **`sys/queue.h`**：功能丰富，适用于复杂应用场景，提供了更多数据结构和操作。
- **`queue.h` by Ben Noordhuis**：轻量级，设计简洁，适用于需要简单队列或链表操作的项目。
