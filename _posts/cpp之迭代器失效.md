---
title: cpp之迭代器失效
date: 2019-03-20 17:07:32
tags:
	- cpp

---

--

**迭代器是一种**检查容器内部元素并遍历元素的**数据类型**。

**c++更推荐使用迭代器，而不是用下标进行操作。**

因为每一种容器都支持迭代器，只有少数容器支持下标操作。



可以简单理解，迭代器就是指针。



看muduo的相关博客，看到这句话：

```
这两个 indices 的类型是 int，不是 char*，目的是应对迭代器失效。
```

迭代器失效具体代表了什么？

# 什么是迭代器

讨论迭代器失效之前，我们先看看什么是迭代器。

```
1、迭代器是连接容器和算法的纽带。
2、为数据提供了抽象。这样写算法的人就不用关心数据结构的细节。
3、迭代器提供了数据访问的标准模型：对象序列。

迭代器是一种广义的指针。
是指向序列元素指针概念的一种抽象。
```



泛型编程的关键所在，就是如何找到一种通用的方法，来访问具有不同结构的各种容器中的每个元素。



```
容器是数组的抽象。
迭代器是指向数字的指针的抽象。
```



在STL里，为每种容器typedef了一个迭代器。

例如：

```
std::vector<T>::iterator
```

# c++迭代器发展历史

C++中的迭代器是用于遍历和访问容器元素的重要概念。迭代器的发展历史可以追溯到早期的C++标准，然后逐渐演变为现代C++中更强大和灵活的迭代器模型。以下是C++迭代器的发展历史的主要里程碑：

1. C++98/03：最初的C++标准（通常称为C++98或C++03）引入了最基本的迭代器概念。它定义了几种迭代器的类别，包括输入迭代器、输出迭代器、前向迭代器、双向迭代器和随机访问迭代器。每种迭代器类别提供了不同级别的功能和操作，可以用于遍历各种容器，如向量、链表和数组。

2. C++11：C++11引入了更强大和灵活的迭代器模型。它引入了新的迭代器类别，如正向迭代器、反向迭代器和可移动迭代器。此外，C++11还引入了自动类型推导和范围基于for循环语法，使迭代器的使用更加简洁和方便。

3. C++17：C++17在迭代器方面引入了一些改进和增强。它添加了`std::optional`迭代器，允许迭代器返回可选值。此外，C++17还引入了`std::size`函数，用于获取容器的大小。

4. C++20：C++20对迭代器进行了进一步改进和扩展。它引入了三个新的迭代器类别：`contiguous_iterator`、`common_iterator`和`counted_iterator`。此外，C++20还添加了新的迭代器操作，如`std::ranges::views`和`std::ranges::actions`，用于更方便地处理和操作迭代器范围。

总的来说，C++中的迭代器经历了多个版本的演化和改进，从最初的基本概念发展到现代C++中更加强大和灵活的迭代器模型。这些改进使得使用迭代器更加简洁、安全和高效，提供了丰富的迭代器操作和类别，以满足不同的容器遍历和访问需求。

# 迭代器的基本特性

```
1、解除引用。
	就是类似指针取值一样。
2、赋值。
3、比较。
4、遍历。
```

# 迭代器的操作

```
1、读。
2、写。
3、访问。
4、迭代。
5、比较。
```

不同的泛型算法，对迭代器的要求也不同。

例如，查找算法，只要求迭代器定义++操作符，这样就可以遍历整个容器。

查找算法，并不需要修改数据，所以不需要写操作。

# 迭代器基本使用方法举例

当使用C++中的迭代器时，以下是一些基本的使用方法的示例：

1. 迭代器的声明和初始化：

```cpp
std::vector<int> numbers = {1, 2, 3, 4, 5};
std::vector<int>::iterator it;  // 声明一个迭代器
```

2. 迭代器的遍历：

```cpp
// 使用循环遍历容器元素
for (it = numbers.begin(); it != numbers.end(); ++it) {
    std::cout << *it << " ";
}
std::cout << std::endl;
```

3. 迭代器的解引用和访问元素：

```cpp
// 解引用迭代器以访问元素
std::cout << "First element: " << *numbers.begin() << std::endl;
std::cout << "Second element: " << *(numbers.begin() + 1) << std::endl;
```

4. 迭代器的逆向遍历：

```cpp
// 逆向遍历容器元素
std::vector<int>::reverse_iterator rit;
for (rit = numbers.rbegin(); rit != numbers.rend(); ++rit) {
    std::cout << *rit << " ";
}
std::cout << std::endl;
```

5. 迭代器的算法操作：

```cpp
// 使用迭代器进行容器算法操作
std::vector<int> evenNumbers;
std::copy_if(numbers.begin(), numbers.end(), std::back_inserter(evenNumbers), [](int num) {
    return num % 2 == 0;
});
```

这些示例展示了迭代器的一些基本使用方法，包括迭代器的声明、初始化、遍历容器元素、解引用以及在算法操作中的使用。需要注意的是，这只是迭代器的基本使用方法，实际的使用场景可能会更加复杂，具体取决于所使用的容器类型和需求。

# 迭代器的分类

根据迭代器所支持的操作不同，在STL里定义了5种迭代器。

```
1、输入迭代器。
2、输出迭代器。
3、前向迭代器。
4、双向迭代器。
5、随机访问迭代器。
```



# 迭代器失效

向容器里添加或者删除元素都可能会使得指向容器元素的迭代器失效。

为什么迭代器会失效？

以vector为例，当我们插入一个元素时，它的预分频空间可能不够了。它会重新申请一段内存。把之前的元素复制到新的空间上去。

之前的迭代器，就是一个指针嘛，指针指向的位置已经无效了。





# 参考资料

1、STL中迭代器失效详解

https://blog.csdn.net/skyroben/article/details/70877008

2、C++学习篇——C++ STL中迭代器介绍

https://blog.csdn.net/chenjiayi_yun/article/details/25844205

3、C++ 迭代器失效

https://blog.csdn.net/zhongjiekangping/article/details/5624922