---
title: Linux内核之IS_ERR判断
date: 2018-03-21 20:47:30
tags:
	- Linux内核

---

--

要想明白IS_ERR()，首先要理解内核空间，所有的驱动程序都运行在内核空间。

内核空间虽然很大，但总是有限的。

==在这有限的空间中，**其最后一个page是专门为错误码保留的**，即内核用最后一页捕捉错误，==

一般人不可能用到内核空间最后一个page的指针。

因此，在写设备驱动程序的过程中，涉及到的指针，必然有以下三种情况：

- 有效指针；
- NULL，即空指针；
- 错误指针，或者说无效指针。



==内核里对返回值是指针的，不是用NULL来判断的。==

（虽然很多函数都返回int值，返回指针不是很多）。

内核里的指针值，有3种情况：

1、有效。

2、无效。也叫错误指针。就是已经指向了最后一个page的。

```
对于32位机器，最后一页就是0xfffff000这里。指针值大于这个值，就是一个错误指针了。
因为正常不可能到这里的。
```



3、NULL。



返回指针的判断有这么几个宏：

```
IS_ERR
PTR_ERR
ERR_PTR
```



# 参考资料

1、linux内核中的IS_ERR()、PTR_ERR()、ERR_PTR()

https://blog.csdn.net/ljk0922/article/details/47911203