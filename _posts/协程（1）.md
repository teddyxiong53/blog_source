---
title: 协程（1）
date: 2019-09-03 14:51:03
tags:
	- python
---

1

C语言能不能实现协程？

协程的底层实现是什么？

协程是在用户空间，利用编程语言的语法语义就就能实现逻辑上的多任务的一种编程技巧。

函数调用是协程的一种特殊情况。

协程概念出现，还在线程之前。

你可以很容易在一个线程里创建上万个协程，就像调用上万个函数一样。

C语言缺乏yield语义。

所以无法原生支持协程。

Adam Dunkles有写一个protothreads的库，这个可以给C语言增加协程支持。

只有5个头文件，使用非常方便，非常轻量。



python里的yield会保留上次函数的调用位置，下次调用就从上次的位置继续进行。

c++协程

腾讯有开源一个libco，是c++写的协程库，微信的后台就用了这个。

c++20标准，开始引入语言级别的协程支持。这个还是任重道远。



还是看Python里的协程。

gevent是python里的一个网络库，基于协程。

它底层使用的是greenlet的基于libevent的高层同步api。

可以让开发者不用改变编程习惯。





协程和io多路复用有什么关系？协程的os底层实现就是io多路复用。



讨论生成器之前，我们先看迭代器。

什么是迭代器？就是可以被迭代的对象，就是可以被一个一个取值，直到取完为止。

python里，可以用iter函数来把一个list转成一个迭代器。

```
lst = [1,2,3] 
it = iter(lst)
it.next()     
```

生成器可以看做迭代器的子类。同时提供了更强大的功能。

```
def func():
    yield 1
    yield 2
    yield 3

it = func()
print(next(it))
```

我们可以把生成器理解成协程。



协程的调度都是在用户空间完成的。



Kiev框架是魅族的推送平台使用的C++后台开发框架。

由这些组件组成：

```
1、rpc框架。
2、fastcgi框架。
3、redis客户端。基于hiredis封装。
4、mysql客户端。基于mysqlclient封装。
5、mongodb客户端。
6、配置中心客户端。
7、基于zookeeper的分布式组件。服务发现，负载均衡。
8、日志模块。
9、状态监控模式。
10、核心模块是libgo协程库。
```

并发模型是CSP模型的变种，golang就是用了这种模型。

选择这种模型的原因是：

1、这种模型的开发效率远高于异步回调方式。

2、性能上没有妥协。





参考资料

1、Python并发编程协程(Coroutine)之Gevent

https://www.cnblogs.com/zhaof/p/7536569.html

2、一个“蝇量级” C 语言协程库

https://coolshell.cn/articles/10975.html

3、C++ 协程的近况、设计与实现中的细节和决策

https://www.jianshu.com/p/837bb161793a

4、C/C++ 协程库boost.coroutine2、魅族libgo、腾讯libco、开源libaco详解

https://blog.csdn.net/zzhongcy/article/details/89515037

5、线程、进程和协程以及 IO 多路复用实现并发

https://razertory.me/2018/11/19/tread_and_process/

6、10-线程，进程，协程，IO多路复用

https://www.cnblogs.com/can-H/articles/6610683.html

7、python协程进阶，原来实现一个事件循环可以如此简单！

https://blog.csdn.net/zhoulei124/article/details/94319248

8、协程（一）协程的定义与分类

https://blog.csdn.net/wuhenyouyuyouyu/article/details/52709395

9、C/C++ 协程库boost.coroutine2、魅族libgo、腾讯libco、开源libaco详解

https://blog.csdn.net/zzhongcy/article/details/89515037