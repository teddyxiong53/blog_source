---
title: cdn了解
date: 2018-01-07 07:50:32
tags:
---



# 1. 从实例看cdn的产生

先看html文件里的文件引用。一般是css和js文件。

例如：

```
<script src="/src/test.js"></script>
```

这个是一个相对地址，指向的是站内的文件。但是其实也可以这样：

```
<script src="www.xxx.com/test.js"></script>
```

这个就叫绝对地址的方式。

使用相对地址的，一般是小型项目，压力不大。

使用决定地址的，一般是服务器压力大，所以把js文件、css单独放到专门的服务器上。减轻主服务器的压力。

网站的访问速度，只基于一点，那就是网页内容传输到用户电脑的速度。

假如你的公司内部搭了一个网站，优化很好，内部使用很好，然后你们公司在很远的地方开了一个分公司，在分公司访问公司的网站就很慢了，因为物理距离远了。这时候你就想，在分公司那边部署一套内容缓存就好了，缓存内容跟总公司这边同步。这个问题暂时解决了。但是随着公司的规模不断扩大，公司又开了不少的其他分公司。如果每个分公司都这么来一遍，也是很烦人的，成本也高。怎么办？那就华东、华南、华中、华北各放一套，不同地方的分公司就近取内容。这样就相当于一个简单CDN系统了。

# 2. 国内哪些公司在做cdn

传统的有网宿等。

现在BAT都进入这个行业了。基于自己的云服务来做。

技术壁垒是不大，大的是关系壁垒。
网宿，蓝讯，帝联这几家还是占有着绝大部分的市场。
之所以会出现这样的情况，一方面是因为建设和维护CDN的成本实在是太高了，几个亿都不叫事。另一方面，有钱你以为就能在好的机房弄到一个机柜了？图样图森破啊，这才是以上几家最大的壁垒。



# 3. cdn的由来

克林顿的性丑闻报告放在互联网网上供用户下载，因为用户过多，导致服务器崩溃。这个事件促使了cdn的诞生。

cdn的出现是为了解决这些问题：

1、解决网站高流量、大并发的问题。

2、解决南北互联的问题。我国的网络格局是划江而治的格局。因为利益之争，各个网络服务商之间是相互限制的，这就导致了各网之间的互联互通存在很大的问题。

3、访问加速。cdn采用缓存技术，把访问对象缓存到硬盘，有的甚至可以缓存到内存（例如用Varnish工具）。

4、降低总体的运营成本。好的机房费用贵，我们把源站放在好的机房，缓存服务器放在不太好的机房。

5、提高网站的可用性。源站被访问的次数减少了，出现硬件故障的几率就降低了。cdn用集群来提高可靠性。

6、防止ddos攻击。

# 4. cdn适用的场合

任何一门技术，都有适用的场合，cdn也不例外。

cdn只对静态文件适用。

我们为了充分利用这个特点，可以通过把动态内容静态化、静态内容分离这些手段来优化。

哪些对象是静态可缓存的呢？

html文件、视频文件、js文件、css文件、exe文件，图片文件等。



# 5. cdn由哪些构成

cdn一套组合技术。包括：

1、源站。就是你的网站部署的服务器。

2、缓存服务器。缓存源站的内容。

3、智能dns。整个系统的核心。根据用户的来源，把请求转到最近的缓存服务器。使用的技术是Bind软件。

4、客户端。就是用户的浏览器。

# 6. 一个简单cdn网络设计



## 设计的基本原则

1、选点合理。能够覆盖到大部分用户。最起码要在电信和网通机房防止缓存服务器。如果预算够的话，把教育网也考虑进来。

2、系统本身要具备高可用性。缓存服务器用集群就可以搞定。

3、核算自建cdn的成本。

4、伸缩性要好。利于扩展。

## 需求描述

现在有3个站点要进行加速。

主站：www.xxx.com

图片站：images.xxx.com

下载站：dl.xxx.com

这3个站点都是静态的，非常适合进行缓存。

我们放置4组服务器来做缓存：电信1组、网通2组、教育网1组。



## 具体操作

### 工具

1、所有服务器用centos。

2、dns用bind软件。

3、缓存服务器由两种选择：Squid和Varnish。Squid用在复杂场景，Varnish简单实用。我们选择Varnish。

4、负载均衡用Ipvsadm和Keepalived。Ipvsadm是核心，负责包转发和负载分摊。Keepalived为框架，负责故障隔离和失败切换。

5、web server用nginx。



cdn还依赖与dns解析。如果你直接通过ip地址来访问，cdn就不起作用了。



参考资料

1、《CDN 之我见》原理篇——CDN的由来与调度

这个是一个系列文章。

https://linux.cn/thread-17631-1-1.html

2、为什么域名能够访问网站，而直接使用IP不可以

这篇文章很好。

https://blog.csdn.net/gui951753/article/details/83070180

3、CDN使用了哪些DNS技术？

https://www.zhihu.com/question/28884646