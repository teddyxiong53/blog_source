---
title: 投票网站快速开发
date: 2019-03-01 16:29:17
tags:
	- 网站

---



公司总是有投票让大家投票，来决定是否生产对应颜色的产品。当前是发在群里，让大家打字投票。这个太不友好了。我觉得可以做一个简单的投票网站来搞定。

我觉得用nodejs来做是比较好的。

用谷歌搜索“nodejs vote website”。

https://github.com/topics/voting-application

这里找到不少。看看哪个比较好一点。适合快速改造出来。



vote-it

这个是基于React的。

按照readme的跑，访问不了。

https://github.com/eugrdn/vote-it



Votr

这个是python写的。

https://github.com/danidee10/Votr

安装依赖要好几分钟。然后运行还报错。

```
ImportError: No module named flask_migrate
```

这个用sudo来安装依赖。再看看。



realtime-voting

基于nodejs的。

https://github.com/Srushtika/realtime-voting



到oschina上去搜索“投票”。

voteapp

这个是基于vue写的。

https://www.oschina.net/p/voteapp





我觉得，就基于flask自己做一个吧。

界面先就用最简单的。先实现功能。



需要实现的功能：

```
1、注册。
	需要：名字。年龄。性别。密码。
2、登陆。
3、投票。
	记住点击的顺序。选5张图片。
4、结果展示。
	
5、数据库访问。
	
```



但是我一开始弄，就被各种版本问题给挡住了。真烦人。



我还是用nodejs吧。

前端就用jQuery。

http://sahatyalkabov.com/create-a-character-voting-app-using-react-nodejs-mongodb-and-socketio/



快速搭建简单动态网站的方法。

前端服务器用nginx。



先找一个网格布局的css文件。

https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_image_grid_responsive

这个就可以了。

然后加上选择图片的效果。这段代码可以。需要引入jQuery。

https://blog.csdn.net/qq_38334525/article/details/77817089

```
<script type="text/javascript">
    $(document).on("mousedown",function(e){
      if ($(e.target).is('img')) {
        var s = window.getSelection();
        s.removeAllRanges();
        var range = document.createRange();
        console.log(e.target);
        range.selectNode(e.target);
        s.addRange(range);
      }
    })
</script>
```

但是没有多选的效果。

这里有实现多选的效果的。

http://loudev.com/

提交到github上进行代码管理。



前端收集的数据，如何提交给后端处理。

后端我还是用nodejs写。但是就用最简单的方式。如果可以，都不用express。

后端就写这么一个app.js文件。

```
var http = require("http")
var fs = require("fs")

var server = http.createServer(function(req, res) {
    req.on("data", function(data) {
        console.log("服务器收到的数据：" + decodeURIComponent(data))
    })
    req.on("end", function() {
        console.log("客户端请求数据全部接受完毕")
    })
    res.end()
}).listen(3344, "192.168.56.101", function() {
    console.log("listen on 3344");
})
```

前端用一个form进行提交就好了。

```
<form action="http://192.168.56.101:3344" method="POST">
<script type="text/javascript">
    // run pre selected options
    $('#pre-selected-options').multiSelect();
</script>
名字：<input type="text" name="name"><br>
年龄：<input type="number" name="age">
<input type="submit" value="提交">
</form>
```

现在这个通路是通的。



接下来是考虑什么？

把后端http收到的数据保存到数据库里。

就用mongodb吧。

写一个test_db.js文件。

```
const MongoClient = require("mongodb").MongoClient
var dburl = "mongodb://127.0.0.1:27017/test"

MongoClient.connect(dburl, (err, db)=> {
    if(err) {
        console.log("connect to mongodb test fail")
        return
    }
    console.log(db)
})
```

我尽量不要生成单独的node_modules目录。

运行，提示没有mongodb模块。

我用这样全局安装：

```
npm install mongodb -g
```

再运行，正常了。

但是看这篇文章的代码并不适合在我的项目里使用。所以暂时放弃。

因为每次都操作都需要进行connect，在connect的回调里做操作。这也太麻烦了吧。

不能连接一次，在没有关闭之前，就可以任意操作吗？

看参考资料3，说是用mongoose模块。mongoose是模型工具。

我还是把app.js改造成express的吧。

不做什么路由。就最简单的方式。不用模板。



我想了一下，这个小项目一定要写完整。

先用jquery写。

后面可以写vue版本。



我要把网格布局先写一下。

```
我觉得还有种方式：
1、pdf放到网站上，可以预览。
2、网页上只放CheckBox，大家把喜欢的勾选就好了。然后提交。
这样网页布局就非常简单了。
```



现在最重要的是把逻辑写通先。不要复杂化。

图片就用ul和li来布局。

一行一张图片。后面跟5个CheckBox。

当前在逻辑上，需要做到：

```
1、每一行，只能有一个选中。
2、每一列，也只能有一个选中。
3、提交前，要检查是否选中了刚好5个，否则弹窗提示用户选择。
```

我觉得最好还是搞一个表格。

某一列有被选中的了，则这一列改为绿色。这样方便用户。



写起来挺麻烦的。

这个控制获取方式，不太熟悉，跟其他语言编程的不同。

难以准确获取控件。



现在先不做有效性判断了。



清空所有radio的选中状态，需要用proc。1.6版本以后。1.6版本之前，是用attr函数。

```
$("#clear_all").click(function() {
        $('input[type=radio]').prop("checked", false)
        console.log("clear all select")
      })
```





参考资料

1、

https://hackernoon.com/build-a-realtime-voting-app-in-less-than-10-min-336ec364b5da

2、node.js操作Mongodb数据库

https://segmentfault.com/a/1190000011443234

3、mongodb的正确连接方式应该是什么？

https://segmentfault.com/q/1010000008772678