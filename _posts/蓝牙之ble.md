---
title: 蓝牙之ble
date: 2018-07-23 22:28:29
tags:
	- 蓝牙

---

--

# 什么是ble

低功耗蓝牙（Bluetooth Low Energy，简称BLE），也称为蓝牙4.0及更高版本，是一种通信技术，旨在实现低能耗、短距离通信。它是经典蓝牙（Classic Bluetooth）的一种扩展，专门设计用于低功耗应用和物联网（IoT）设备连接。

BLE的主要特点包括：

1. **低功耗：** BLE专为电池供电设备设计，其工作方式和协议结构经过优化，以实现尽可能低的能耗。这使得BLE非常适合需要长时间运行的设备，如可穿戴设备、传感器、健康监测设备等。

2. **短距离通信：** BLE适用于短距离通信，通常在几米到十数米范围内。这有助于减少干扰和提高通信的安全性。

3. **快速连接：** BLE设备可以在非常短的时间内建立连接，以减少连接延迟，适用于需要快速响应的应用场景。

4. **多设备连接：** BLE支持多设备并行连接，这对于物联网环境中的设备互联非常重要。

5. **简化的协议栈：** BLE的协议栈相对较轻量，适用于资源受限的设备。这有助于减少开发成本和功耗。

6. **广播和扫描：** BLE设备可以通过广播发送数据，其他设备可以通过扫描接收广播数据。这种方式适用于一对多通信，如室内定位。

7. **异步数据传输：** BLE支持异步数据传输，适合断断续续的低频数据传输。

由于BLE的低功耗特性和适用范围广泛的特点，它在健康监测、智能家居、可穿戴设备、物联网、工业自动化等领域得到了广泛应用。

# le audio是基于ble吗

是的，LE Audio（Low Energy Audio）是基于低功耗蓝牙（BLE）技术的一项扩展，旨在为蓝牙设备提供更强大的音频功能。LE Audio扩展了BLE技术，使其能够支持高质量的音频传输和更广泛的音频应用。

传统的低功耗蓝牙（BLE）在音频传输方面有一些限制，因为其设计主要是为了低功耗通信，而不是高质量的音频传输。LE Audio的引入旨在弥补这些限制，为蓝牙设备提供更好的音频体验。

LE Audio引入了以下一些新的功能：

1. **LC3编解码器：** LE Audio引入了更高效的音频编解码器，称为LC3（Low Complexity Communication Codec）。LC3编解码器可以在相对低的比特率下提供高质量的音频传输，从而实现更好的音频效果。

2. **多流传输：** LE Audio支持多个音频流同时传输，这对于多个听者之间共享音频或实现多个音频设备的协同工作非常有用。

3. **广播音频：** LE Audio引入了支持广播音频的功能，这意味着BLE设备可以广播音频流，其他设备可以扫描并连接以接收音频流，这有助于实现一对多的音频广播。

4. **声学共享：** LE Audio引入了声学共享功能，允许多个用户共享同一音频源，例如在公共场所或公共交通工具中。

总之，LE Audio是基于BLE技术的一项扩展，旨在提供更好的音频体验和更广泛的音频应用。它使BLE设备能够支持高质量的音频传输，从而扩展了BLE的应用范围。

# le audio的包结构

LE Audio的包结构是指在蓝牙低功耗音频（LE Audio）传输中，数据在传输过程中如何组织和封装。LE Audio引入了新的数据包结构以支持音频传输。以下是LE Audio的包结构概述：

在LE Audio中，音频数据通过一系列的音频数据包进行传输。每个音频数据包包含了一定数量的音频采样数据。音频数据包通常会通过BLE连接从发送端传输到接收端。

LE Audio的包结构如下：

1. **头部（Header）：** 每个音频数据包的开头包含一个头部，其中包含了一些控制信息，如数据包类型和流标识等。

2. **音频采样数据（Audio Samples）：** 在头部之后是音频采样数据。这部分包含了音频信号的采样值。数据包的大小和数据传输速率决定了每个数据包中包含的音频样本数量。

3. **纠错检验（Error Correction）：** 为了提高传输的可靠性，一些音频数据包可能包含纠错检验信息。这有助于在数据传输过程中检测和纠正错误。

4. **标识和同步（Identification and Synchronization）：** 在BLE连接中，数据包同步和识别非常重要。数据包中通常包含了标识和同步信息，以确保接收端可以正确解析数据包。

5. **连接维护信息（Connection Maintenance）：** LE Audio在数据包中还包含了一些连接维护信息，以确保数据的连续传输。

需要注意的是，LE Audio的包结构可能会因不同的音频编码、数据传输速率、连接参数等而有所不同。具体的包结构会根据实际应用和配置进行调整。这只是一个一般的概述，详细的包结构可以在LE Audio相关的蓝牙规范文档中找到。

# le audio一个包的大小

LE Audio的一个音频数据包的大小可以根据具体的配置和使用情况而有所不同。然而，LE Audio的一个典型音频数据包的大小通常在几十字节到一百多字节之间。

具体的包大小取决于以下因素：

1. **音频编码：** 使用不同的音频编码器（如LC3）会影响一个数据包中包含的音频样本数量，从而影响包的大小。

2. **采样率：** 音频数据的采样率（每秒采样次数）也会影响一个数据包中包含的音频样本数量。

3. **数据传输速率：** 数据传输速率决定了每个数据包中可用的比特数，进而影响包的大小。

4. **连接参数：** 蓝牙连接参数，如连接间隔和数据包长度等，也会影响一个数据包的大小。

5. **纠错码：** 数据包中是否包含纠错码信息以及纠错码的类型也会影响包的大小。

一般情况下，LE Audio的音频数据包大小在20字节到100字节之间。这个范围可以用于传输高质量音频，同时保持较低的延迟和功耗。

如果您在特定应用中需要精确的数据包大小，请参考相关的蓝牙规范和技术文档，这些文档会详细描述LE Audio的包结构和参数配置。

# 当前的导游讲解器是基于什么技术

当前的导游讲解器通常基于无线通信技术，其中常用的技术之一是无线语音传输技术。这些导游讲解器使用无线通信技术来实现导游和游客之间的实时语音传输，以便在旅游景点、博物馆、展览等场所提供有声导览和讲解服务。

以下是一些可能用于导游讲解器的无线通信技术：

1. **无线电频率通信：** 这是较早期使用的无线技术，通常基于无线电频率的传输。导游和游客使用不同的频率来进行语音传输，类似于对讲机的原理。

2. **蓝牙技术：** 低功耗蓝牙（BLE）可以用于导游讲解器，它可以在短距离范围内实现实时的语音传输，同时具备较低的功耗。

3. **Wi-Fi技术：** Wi-Fi技术可以用于实现更远距离的语音传输，但通常需要更多的功耗。导游和游客可以通过连接到相同的Wi-Fi网络来进行语音交流。

4. **RFID技术：** 射频识别（RFID）技术可以用于在特定区域内触发语音播放。游客带着携带RFID标签的设备，在接近特定位置时，设备会自动播放相应的讲解内容。

这些技术可以根据实际需求和场景选择。导游讲解器的设计要考虑到语音传输的稳定性、实时性、通信范围、功耗以及用户友好性等因素。不同的技术有不同的优势和限制，选择合适的技术取决于特定的应用需求。

# 基本信息

经典蓝牙bt。1.0到2.0到3.0，都是。其中1.0和2.0，叫传统蓝牙，3.0叫高速蓝牙。

低功耗蓝牙ble。4.0是。



CC2540是ble单模芯片。是不兼容传统蓝牙的。

安卓要4.3以上版本才能支持ble。



常说的蓝牙4.0一般就是指ble。

**ble默认不能传输音乐。**

**ble就是用来传输少量数据的。**



大家可以理解为service就是java里的class，characteristic是class里的public方法。所以我们应该先找到class，再调用其方法。

再往下想，写和读肯定是两个方法，所以也会是两个characteristic。

service和characteristic的uuid都是通信之前双方约定好的。android端在上文说的discoverService之后，查看有没有对应的uuid，如果有，就可以发起通信了。





![v4f6bxnfb3](../images/random_name/v4f6bxnfb3.jpeg)



# 规范

参考资料

1、

https://www.cnblogs.com/xiaorenwu702/p/4304378.html

# ble地址类型

BLE（蓝牙低功耗）设备的地址类型分为以下几种，每种地址类型有不同的用途和特性。理解这些地址类型有助于更好地管理和开发 BLE 设备。

### BLE 地址类型

1. **Public Device Address (公共设备地址)**
   - **特征**：固定且全球唯一，由蓝牙设备地址 (BD_ADDR) 组成，包含一个 24 位公司标识符（OUI）和一个 24 位设备标识符。
   - **用途**：用于需要唯一标识的设备，如手机或笔记本电脑。

2. **Random Device Address (随机设备地址)**
   - **分类**：
     1. **Static Random Address (静态随机地址)**
        - **特征**：设备启动时生成，除非设备重启或电池更换，否则不会改变。静态地址的最高两个位设置为 11。
        - **用途**：提供稳定性，适用于隐私要求较低的设备。
     2. **Private Random Address (私有随机地址)**
        - **进一步分类**：
          - **Resolvable Private Address (可解析的私有地址)**
            - **特征**：使用一个由设备和配对设备共享的密钥生成，定期更改以提供隐私保护。配对设备可以解析地址以识别设备。
            - **用途**：隐私保护，适用于定期广播的设备，如健身追踪器。
          - **Non-Resolvable Private Address (不可解析的私有地址)**
            - **特征**：随机生成且短时间内使用，不包含可用于识别设备的持久信息。
            - **用途**：提供最高级别的隐私保护，适用于短时间广播的设备。

### 地址类型的具体表示

每种 BLE 地址类型在数据包中都有相应的表示方法。

| 地址类型               | 表示方法 | 说明               |
| ---------------------- | -------- | ------------------ |
| Public                 | 0x00     | 公共设备地址       |
| Random Static          | 0x01     | 静态随机地址       |
| Private Resolvable     | 0x02     | 可解析的私有地址   |
| Private Non-Resolvable | 0x03     | 不可解析的私有地址 |

### 地址生成和使用示例

1. **生成和使用公共设备地址**
   公共设备地址由设备制造商分配，通常在设备出厂时已固定。

2. **生成静态随机地址**
   静态随机地址在设备首次启动时生成，并存储在设备的非易失性存储器中。
   
   ```c
   // 生成静态随机地址示例（伪代码）
   uint8_t random_address[6];
   random_address[0] = random_byte();
   random_address[1] = random_byte();
   random_address[2] = random_byte();
   random_address[3] = random_byte();
   random_address[4] = random_byte();
   random_address[5] = (random_byte() & 0x3F) | 0xC0;  // 设置最高两位为11
```
   
3. **生成可解析的私有地址**
   可解析的私有地址使用设备和配对设备共享的 IRK（Identity Resolving Key）生成。蓝牙协议栈通常会处理这个过程。

### 使用示例

假设你要实现一个 BLE 设备，并希望支持多种地址类型。以下是如何在代码中实现地址选择的示例：

```c
#include <stdio.h>
#include <stdint.h>

// 生成一个随机字节的示例函数
uint8_t random_byte() {
    return rand() % 256;
}

// 生成静态随机地址的函数
void generate_static_random_address(uint8_t address[6]) {
    for (int i = 0; i < 5; ++i) {
        address[i] = random_byte();
    }
    address[5] = (random_byte() & 0x3F) | 0xC0;  // 设置最高两位为11
}

// 打印地址
void print_address(const char *label, uint8_t address[6]) {
    printf("%s: %02X:%02X:%02X:%02X:%02X:%02X\n", label, address[5], address[4], address[3], address[2], address[1], address[0]);
}

int main() {
    uint8_t static_random_address[6];
    generate_static_random_address(static_random_address);
    print_address("Static Random Address", static_random_address);

    // 其他地址类型的生成和使用可以类似实现
    return 0;
}
```

### 总结

不同类型的 BLE 地址在不同的应用场景下有各自的优势和适用性。理解这些地址类型及其特性，可以帮助开发者更好地设计和实现 BLE 设备的通信和隐私保护功能。

# 参考资料

1、普及一下什么是蓝牙和BLE，看完让你秒懂

https://www.sohu.com/a/167206747_404276

2、ESP32必杀技 - 蓝牙配网篇

http://club.gizwits.com/thread-4966-1-1.html

3、蓝牙4.0 BLE与传统蓝牙之间的兼容性

http://blog.51cto.com/cto521/1638654

4、请问，蓝牙4.0协议能不能传音频或文件? 

https://bbs.csdn.net/topics/391493417?page=1

5、Android BLE4.0(蓝牙通信)

https://www.jianshu.com/p/2b4620c52d47

6、

https://e2echina.ti.com/question_answer/wireless_connectivity/bluetooth/f/103/t/111227

7、Android蓝牙通信过程详解

https://cloud.tencent.com/developer/news/216558

8、

https://blog.csdn.net/zzfenglin/article/details/51304084