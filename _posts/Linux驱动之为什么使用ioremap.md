---
title: Linux驱动之为什么使用ioremap
date: 2018-04-09 10:05:32
tags:
	- Linux驱动

---

1

为什么驱动里读写soc的寄存器的时候，需要用ioremap来拿到虚拟地址再操作呢？

因为这个时候已经打开mmu了。不能直接访问物理地址了。

默认外设io资源是不再内核的空间的。

如果要访问改外设资源，就需要把它映射到内核空间里来。然后才能在内核空间里访问它。



ioremap返回是在3G到4G之间的一个虚拟地址。



也可以通过静态映射map_desc来做。

这个是建立了一一映射。



结论：
    1、ioremap 按照页大小进行映射，而且是 整页 。
    2、ioremap 允许对一个物理地址进行多次映射，而且分配的虚拟空间地址各不相同（多个虚拟地址对应于同一个物理地址）。而且，ioumap相互不影响。

参考资料

1、ioremap映射的问题

https://blog.csdn.net/ultraman_hs/article/details/53337056