---
title: 京东脚本
date: 2021-01-15 14:46:11
tags:
	- 生活

---

--

除了之前用的js写的京东多合一签到脚本OpenWrt插件，还有python写的

https://github.com/Zero-S1/JD_tools

这2个签到豆子不多。

现在又有新的脚本，基于docker来部署，把东东农场等功能都做了自动化处理。

试一下。

```
1. SSH进入Op后台，用户名默认root，密码为password；

2. 拷入以下指令，回车执行

wget -q https://gitee.com/jerrykuku/jd-docker/raw/master/jd-docker.sh -O jd-docker.sh && chmod +x jd-docker.sh && sh jd-docker.sh

3. 安装好jdcookie插件，浏览器登陆bean.m.jd.com获取你的cookies （详见本群op的特色插件 “京东签到服务”的使用说明）

4. 按屏幕要求填入 pt_key=xxxxxxxxxx;pt_pin=xxxx; 
（注意其中没有任何空格，本群最新狗东签到插件能够直接获取）

点击这里下载新的cookie获取插件 ；

5. 如你喜欢用微信来获取撸豆的数据推送，填入Server酱的SCKEY （ http://sc.ftqq.com/ ）；

6. 如你更喜欢TG推送的方式，请参考 https://github.com/lxk0301/jd_scripts/blob/master/backUp/TG_PUSH.md

7. Docker-CE的打开方式，请参考Op中Docker-CE的使用说明档 （从第5步开始操作就行了，本群大佬已经把1-4步的任督二脉打开）；

8. 撸豆的docker镜像拉取过程中，请保持网络顺畅，建议全局翻墙；

9. 一键脚本的执行过程中若发生错误导致失败，可执行 

sh /root/jd-docker.sh 

继续，如果你的jd-docker.sh脚本确实在root目录下的话。

10. 如果你需要添加更多的cookie和推送方式，请自行用vi或者sftp的方式修改jd-docker/config/config.sh文件，推荐使用Notepad++来编辑（具体度娘），除非你喜欢看乱码！

11. 最后，热衷于手动执行脚本的群友，可执行 

docker exec jd-script bash jd bean_change now

Enjoy!
```

但是我总是碰到问题，就是我把账号配置好了。然后执行

```
docker exec jd-script bash jd bean_change now
```

就提示cookie没有配置。

```
$ docker exec jd-script bash jd bean_change now
请先在config.sh中配置好Cookie...
```

然后看config.sh里了，确实配置的内容都被空值覆盖了。

为什么会这样？

删掉容器和镜像，重新来过。我之前下载镜像的时候，的确出了点问题。

但是这样做了，还是一样的现象。

进入到容器里看看

```
 docker exec -it jd-script bash   
```

在这里面编辑cookie，可以成功。

就这样吧。

效果很好，京豆数量多了很多。

现在分析一下，看看最多可以拿到多少京豆每天。

# 安装脚本分析

先看安装脚本做了哪些事情

```
docker安装
	如果发现当前系统没有安装docker，就进行安装。
设置配置文件的存放路径
	直接回车，是使用当前路径，我是在/root目录下。
	配置文件在/root/jd_docker/config/
	日志文件在/root/jd_docker/log
下载配置文件模板。
	https://gitee.com/evine/jd-base/raw/v3/sample/config.sh.sample
	放到config/config.sh
然后替换作者的助力码
	替换了这几个：
	ForOtherFruit1
	ForOtherBean1
	ForOtherJdFactory1
	ForOtherJdzz1
	ForOtherJoy1
下载定时任务列表
	https://gitee.com/evine/jd-base/raw/v3/sample/docker.list.sample
	放到config/crontab.list
创建容器并执行
	是直接运行，靠docker自己去发现本地没有jd-script这个镜像，然后自动去下载的。
	 -v $config_path:/jd/config \
    -v $log_path:/jd/log \
    -p 5678:5678
    evinedeng/jd:gitee # 这个就是容器了。
下载安装更新监听容器
	watchTower
	
提示安装完成。
```



docker镜像的地址

https://registry.hub.docker.com/layers/evinedeng/jd/gitee/images/sha256-b342c00548d9e23320702794fa5fc9f0498104df08738acf0f2b542eaf4d737d?context=explore



# 容器里的脚本分析

通过目录进入到容器里：

```
docker exec -it jd-script bash
```

我们看上面的一条定时任务的命令：

```
bash jd jd_bean_change
```

都是通过jd.sh这个来调用的。

jd_bean_change则对应/jd/scripts/jd_bean_change.js脚本。



​	



# 定时任务列表

```
每天5到23点的55分，都检查一次脚本是否有更新。
每天13点57分，删除指定天数之前的日志。
每天5点48分，导出所有互助码清单。放在log/export_sharecodes目录下。

下面的就是执行js脚本的
9点5分：京豆对换
5点28分：京豆home
0点和9点的4分：京豆签到
0点的0分和30分：blue coin
8点，12点，18点的12分：京豆书店
7点37分：京东汽车
8点和22点的13分：京东现金
0点0分：京东汽车交换
0点2分：俱乐部抽奖
13点34分：crazy joy
2-23点的54分：鸡蛋
每个小时的20分：梦工厂
7点，12点，18点的29分：水果
6点49分：获取share code
每个小时的36分：京东工厂
11点14分：jdzz
0,8,9,13,18,22的6分：jd_joy
0到22点，每过20分析：喂宠物
每天4次：jd_joy_reward
11点，14点的18分：joy_run
0点，6点的0分：joy_steal
9点，12点，18点0分：jxnc？
7点32分：jd_kd？
13点，13到33分，每5分钟，执行jd_live
每天1点15分，执行抽奖
每4个小时的40分：摇钱树
0点，20点的20分：京东项链？
7点，12点，18点的10分：宠物
每25分钟：pigPet
7到22点的35分：种豆得豆
0点11分：rankinglist？
1点1分：红包
0点0分：jd_shop
0点16分：jd_small_home
每3个小时的35分：jd_speed
每5个小时的9分：京东超市
9点25分：jd_syj
5点44分：jd_unbind？
23点45分：jd_unsubscribe
11点19分：jx_sign应该是京喜签到
```

# 配置内容梳理

## 自动删除

这个是因为有的活动是有时效性的，活动到期，再执行没有意义，而且容易暴露。

这一项默认为true，会定期清理失效的活动。

只会清理`jd_`、`jr_`、`jx_`（分别表示京东、金融、京喜）开头的脚本。

我们可以在crontab.list里添加自己的任务（我不加）

## 自动添加

跟上面一项类似。

## 删除日志

默认删除7天以前的日志。

## 随机延迟

默认1到300之间的一个随机秒数。

对于不需要精确时间要求的任务。

## user-agent

留空。不要自己定义。

## 推送消息配置

提供了多种通道的。

我留空吧。

不然消息挺多的，也是个麻烦。

可以支持：server酱、bark、telegram、钉钉、igot、cool push、push_plus、企业微信

## 每日签到的通知形式

有3个值：

0：关闭。

1：简洁通知。

2：详细通知。默认值。

## 东东农场互助

需要互助码。怎么查到这个互助码呢？

后面都是各种互助码，这个比较麻烦，不知道哪里拿到这个码。

不管了。反正都是选填的。





# lxk0301/jd_scripts

这个仓库的脚本，是nodejs写的。

https://github.com/lxk0301/jd_scripts

github上的仓库已经删掉了。但是作者还是在持续发布，通过docker镜像更新。

# 同步机制分析

当前只要脚本作者有进行更新，每个运行容器的用户，都可以得到最新的脚本。

这种更新同步机制非常好。值得研究一下。

watchtower  这个容器扮演的是什么角色？





参考资料

1、

