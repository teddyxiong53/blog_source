---
title: flash知识梳理
date: 2018-02-27 20:09:23
tags:
	- flash

---



# nand flash

相比与nor flash，nand flash的一个缺点是容易产生坏块。

因此在使用nand flash的时候，需要使用校验算法来发现并标注坏块。

nand  flash没有地址和数据总线。

**nand flash以page为单位进行读写，以block为单位进行擦除。**

**坏块是指block。**

page内部有分为2个区：

main和spare。

main就是存放数据。

spare存放附加信息。例如坏块标记、块的逻辑地址、ECC校验和。



因为nand flash的工艺限制，在nand flash的生产和使用过程中，会产生坏块。

**坏块的特性是：在擦除和写入的时候，不能将某些位拉高。**



坏块可以分为两种：

1、固有坏块。生产过程中产生的，厂家会在坏块block的第一个page的spare区的第六个bit进行标记。

2、使用坏块。



坏块有可能是假坏块。



mini2440上使用的nand flash是256MB。

page是2K+64.

block是128K+4K。



NAND Flash 在嵌入式系统中的地位与PC机上的硬盘是类似的。

用于保存系统运行所必需的操作系统，应用程序，用户数据，

运行过程中产生的各类数据，系统掉电后数据不会丢失。



读写是以页为单位的，擦除是以块为单位的。
对于Nand的写操作，只能由1变成0，而不能由0变成1。所以必须先对nand执行erase操作，即将0变成1，然后再写（使对应的1变成0）

存储在Nand中的数据容易发生错误，所以采取一定的算法对数据进行编码和解码很有必要。在数据存储到nand flash之前进行编码，连同校验数据一同存储到nand之中；在数据从nand读出之后进行解码，以验证数据是否出错。



## 相关术语

a)、ONFI标准

b)、Block Management(坏)块管理

c)、Wear-Leveling 负载平衡

d)、ECC 错误校验码

e)、SLC 和MLC



## 坏块处理

Nand Flash两种坏块管理方式

本文章介绍的两种坏块管理方式为：**非顺序映射** 和 **顺序映射**

两种管理方式都有优缺点；一般像UCOS等小系统，已经有FAT32等文件系统管理机制，建议使用顺序映射；像linux系统，已经有mtd机制，则可以使用非顺序映射，这样更能保证数据的完整性。





参考资料

1、

https://blog.csdn.net/weixin_37981492/article/details/113348534



## 参考资料

1、NandFlash详解

https://blog.csdn.net/Golden_Chen/article/details/89470673

# nor flash

像访问SDRAM一样，所以可以片内执行。

读时序类似与SDRAM。

可以用来存放代码。

nand flash：

不能片内执行。地址线宽度不确定，是8位、16位或者32位。

主要用来存放数据。U盘的内部就是nand flash。



spi flash则是外挂的flash，不是在芯片的寻址空间里。

优点是便宜。

缺点是速度较慢。

这种spi接口的flash也可以作为mtd设备。



并口flash和串口flash。

对于nor flash而言，CFI接口 = JEDEC接口= 并行接口。



对于S3C2410平台而言，外接的nor flash直接映射在CPU的内存空间上，可以直接用通用的drivers/mtd/maps/physmap.c的驱动。

驱动开发者需要做的事情就是在bsp文件里，配置一下resource。

# nand和nor对比

nor的特点：

1、贵。

2、慢。

3、可靠。

所以nor一般用来保存关键数据。

nand的特点：

1、偏移。

2、快。

3、不太可靠。

所以nand一般用来保存大容量的数据。



# OneNand是什么

是三星推出的一种存储技术。是一种混合存储器。

基础概念是把Nand Flash、SRAM芯片和逻辑芯片继承为一颗单芯片。采用的是Nor Flash接口。

所以集合了Nand的高容量和Nor的读取速度快优点于一身。其中的SRAM是作为高速缓存。

因为集成的SRAM是1K，所以OneNand在最前面的1K，是具有片内执行的能力的。

![image-20230418170029744](images/random_name/image-20230418170029744.png)



OneNAND是三星开发的一种混合型闪存技术，结合了NAND Flash的高密度和NOR Flash的快速随机读取特性。它的设计目的是提供一种具有高读取速度和大容量存储能力的解决方案。

### OneNAND的特点
- **混合架构**：将NAND Flash的存储单元和NOR Flash的控制逻辑结合在一起。
- **高读取速度**：相比纯NAND Flash，OneNAND提供更快的随机读取性能。
- **大容量**：类似于NAND Flash，OneNAND能够提供高密度存储。
- **易于集成**：与传统的NAND Flash相比，OneNAND更容易集成到系统中，因为它包含了一些自管理功能。

### Linux驱动中的OneNAND
在Linux操作系统中，OneNAND设备通过特定的驱动程序进行管理。这些驱动程序位于Linux内核源代码树的 `drivers/mtd/onenand` 目录中。

### Linux驱动中OneNAND的关键部分
1. **初始化**：驱动程序负责初始化OneNAND设备，包括检测设备、设置工作模式等。
2. **读取和写入**：提供对OneNAND存储单元的读写操作接口。
3. **管理功能**：包括坏块管理、磨损均衡等功能，确保存储设备的可靠性和寿命。

### OneNAND的使用场景
由于其混合特性，OneNAND通常用于需要快速读取和大容量存储的嵌入式系统中，如：
- **移动设备**：智能手机、平板电脑等。
- **消费电子**：数码相机、媒体播放器等。
- **工业应用**：需要可靠性和快速读取性能的嵌入式系统。

### 总结
OneNAND结合了NAND和NOR的优势，为嵌入式系统提供了一种高性能、大容量的存储解决方案。在Linux中，通过特定的驱动程序对OneNAND设备进行管理，以确保其高效运行和可靠性。





OneNAND是由三星电子开发的，因此其主要生产商是三星。虽然有一些其他公司可能会生产类似的混合型闪存产品，但OneNAND品牌主要是由三星生产和推广的。

### 使用情况
OneNAND在其推出后的几年内确实得到了较为广泛的应用，特别是在2000年代中期的移动设备和嵌入式系统中。以下是一些具体的信息：

| 应用场景       | 说明                                                         |
| -------------- | ------------------------------------------------------------ |
| **移动设备**   | OneNAND在早期的智能手机和平板电脑中被广泛使用，如三星的多款设备。 |
| **嵌入式系统** | 在一些需要高读取速度和大容量存储的嵌入式应用中使用。         |
| **消费电子**   | 一些数码相机、媒体播放器等设备中使用。                       |
| **工业应用**   | 用于需要高可靠性和快速读取性能的工业嵌入式系统。             |

### 当前使用情况
随着NAND Flash技术的发展和eMMC、UFS等更高级别存储解决方案的出现，OneNAND的使用逐渐减少。目前，市场上更为常见的是eMMC、UFS和纯NAND Flash解决方案，这些方案提供了更高的存储密度、更快的速度和更好的管理功能。

### 总结
虽然OneNAND曾经被广泛使用，但随着新技术的不断发展和进步，其使用范围已经缩小。主要生产商是三星，其他公司生产类似产品的情况较少。现在市场上主流的存储解决方案已经转向eMMC和UFS等更先进的技术。



https://blog.csdn.net/baidu_37973494/article/details/82257606

# Linux flash驱动





参考资料

1、

https://blog.csdn.net/Golden_Chen/article/details/89472163



# sysfs里的mtd和mtdro关系是什么

在Linux系统中，`sysfs`文件系统用于向用户空间导出内核对象和它们的属性。对于内存技术设备（MTD，Memory Technology Device），`sysfs`提供了相应的接口来访问和管理这些设备。

### MTD和MTDRO的关系
`MTD`表示内存技术设备，它们通常代表闪存设备，如NAND、NOR闪存等。`MTDRO`则是只读的MTD设备接口。它们之间的关系如下：

| 项目     | MTD                      | MTDRO                              |
| -------- | ------------------------ | ---------------------------------- |
| **全称** | Memory Technology Device | Memory Technology Device Read-Only |
| **描述** | 代表一个可读写的闪存设备 | 代表相同设备的只读接口             |
| **功能** | 允许对设备进行读写操作   | 仅允许对设备进行只读操作           |
| **位置** | `/sys/class/mtd/mtdX`    | `/sys/class/mtd/mtdXro`            |
| **用途** | 用于管理和操作闪存设备   | 用于保护设备，防止意外写入操作     |

### 具体功能和用途
1. **MTD**：
   - **位置**：`/sys/class/mtd/mtdX`
   - **功能**：提供对闪存设备的全面访问，包括读取、写入、擦除等操作。
   - **用途**：用于需要完全控制闪存设备的场景，如固件更新、数据存储等。

2. **MTDRO**：
   - **位置**：`/sys/class/mtd/mtdXro`
   - **功能**：提供只读访问，禁止写入和擦除操作，确保数据不会被意外修改或删除。
   - **用途**：用于保护数据的场景，防止对重要数据的意外写入或修改。

### 实际操作中的使用
在实际使用中，当需要读取数据时，可以通过`MTDRO`接口进行操作，以确保数据的安全性和完整性。当需要对闪存设备进行写入或擦除操作时，则需要使用`MTD`接口。

### 示例
假设有一个MTD设备`mtd0`，它的读写和只读接口在`sysfs`中的位置分别为：

- **读写接口**：`/sys/class/mtd/mtd0`
- **只读接口**：`/sys/class/mtd/mtd0ro`

用户可以通过这两个接口来分别执行不同的操作，确保在需要保护数据时只使用只读接口，而在需要完全控制设备时使用读写接口。

# 参考资料

1、

https://www.cnblogs.com/lifexy/p/7737174.html

2、mini2440硬件篇之Nand Flash

https://blog.csdn.net/hyq458941968/article/details/45269799