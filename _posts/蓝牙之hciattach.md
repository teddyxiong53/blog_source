---
title: 蓝牙之hciattach
date: 2020-03-24 11:43:11
tags:
	- 蓝牙

---

--

hciattach，是用来把一个串口跟一个蓝牙设备绑定起来，用串口来作为蓝牙的控制接口。

建立串口和蓝牙协议层的数据连接通道。

hciattach工具（使用uart接口的蓝牙才需要这部分），

这个工具的代码在bluez/tools/hciattch.c里。

# 简介

`hciattach`工具用于将蓝牙控制器（Bluetooth Controller）连接到主机的串行设备上。

蓝牙控制器是负责处理蓝牙通信的硬件组件，

而主机是运行蓝牙协议栈的设备，

如计算机或嵌入式系统。

具体来说，`hciattach`工具的作用包括：

1. **初始化蓝牙控制器**：通过连接到蓝牙控制器的串行设备，`hciattach`可以初始化控制器，并确保它可以与主机正常通信。

2. **加载固件**：蓝牙控制器通常需要固件来正常运行。`hciattach`可以加载所需的固件到控制器中，以确保其正常工作。

3. **配置串行端口**：`hciattach`可以配置主机上用于连接蓝牙控制器的串行端口，包括波特率、数据位、停止位、奇偶校验等参数。

4. **启动蓝牙协议栈**：一旦蓝牙控制器连接并初始化成功，`hciattach`还可以启动主机上的蓝牙协议栈，从而使主机能够开始与其他蓝牙设备进行通信。

总的来说，`hciattach`工具是在Linux系统中用于连接和配置蓝牙控制器的重要工具，它确保了主机与蓝牙控制器之间的正常通信，从而实现了蓝牙功能的启用和使用。

# 常用命令

以下是一些常用的`hciattach`命令示例：

1. **使用默认参数连接蓝牙控制器**：
   ```bash
   hciattach /dev/ttyS0 any
   ```
   这个命令将蓝牙控制器连接到串行设备`/dev/ttyS0`上，使用默认的参数。

2. **指定波特率和固件文件**：
   
   ```bash
   hciattach /dev/ttyS1 any 115200 flow
   ```
这个命令将蓝牙控制器连接到串行设备`/dev/ttyS1`上，使用波特率115200，并使用`flow`参数开启硬件流控。
   
3. **指定固件文件**：
   ```bash
   hciattach /dev/ttyUSB0 bcm43xx 3000000
   ```
   这个命令将蓝牙控制器连接到USB串行设备`/dev/ttyUSB0`上，使用`bcm43xx`固件，并指定波特率为3000000。

4. **连接使用3-wire UART的蓝牙控制器**：
   ```bash
   hciattach -t 10 -s 115200 /dev/ttyS0 bcm43xx 3000000
   ```
   这个命令将蓝牙控制器连接到串行设备`/dev/ttyS0`上，使用3-wire UART连接模式，设置超时时间为10秒，波特率为115200，并使用`bcm43xx`固件，指定波特率为3000000。

这些命令示例展示了`hciattach`工具的一些常用用法，可以根据具体的硬件和需求进行调整和扩展。