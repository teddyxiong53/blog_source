---
title: select、poll、epoll区别
date: 2017-05-14 17:37:21
tags:

	- select

---

--

select、poll、epoll都是IO多路复用的机制。

它们从本质上来说，都是同步IO，

因为在监听到可以读写后，就需要自己来进行读写操作，读写过程是阻塞的。



# select的缺点：

1、每次调用select，都需要把fd集合从用户态拷贝到内核态，这个开销在fd很多的时候会比较大。

2、同时每次调用select的时候，都需要再内核遍历所有传递进来的fd，fd很多时，开销也很大。

3、select支持的文件描述符太小了，只有1024个。

poll和select差不多，只是描述fd集合的方式不一样，select是用fd_set，而poll是用pollfd。

==poll就没有了链接数量的限制了。==

==但是内核态和用户态之间的复制还是存在的。==

epoll则是对select和poll的改进。没有了上面的缺点。





select，相对于把一张bit表跟一个fd绑定起来。就看bit表里哪个bit置位了没有。



为什么nginx比apache的性能要高很多？

主要是因为nginx采用了epoll的机制，而apache还是采用老的select机制。

关于selec和epoll的工作原理，有个形象的比喻可以说明。

```
你有个朋友在一个学校读书，住在宿舍楼A里。
但是你不知道他具体在哪个房间。
你可以在宿舍大门口一直等他的出现（这个就相当于阻塞io了）。效率很低。

宿舍有管理员。你可以去找管理员。管理员就相当于select或者epoll。
管理员可以带你去找你朋友。

select这个管理员，是个新来的，效率比较低，他需要一个个宿舍挨个去找。
而epoll，则可以直接带着你直奔目的地。
```



```
select
每次重新循环的时候，要重新设置一下timeval，不然就没有时间限制作用。
```

```
    while(1) 
   { 
        FD_ZERO(&fds); //每次循环都要清空集合，否则不能检测描述符变化
        FD_SET(sock,&fds); //添加描述符
        FD_SET(fp,&fds); //同上
        maxfdp=sock>fp?sock+1:fp+1;    //描述符最大值加1
        switch(select(maxfdp,&fds,&fds,NULL,&timeout))   //select使用
```



pollhup
	这个事件什么时候发生？
	socket的对端关闭，或者read返回0时。会产生这个事件。
pollin
	有数据可以读。
pollout
	可以写数据（缓冲区没有满）。
pollpri
	有紧迫数据可读。

# poll和epoll的区别

`poll` 和 `epoll` 都是 Linux 中用于多路复用 I/O 操作的机制，

它们的主要目的是==允许单个进程同时监视多个文件描述符==以查看它们是否已经准备好读取或写入。

虽然它们的目标相同，但它们在实现和性能方面有一些重要的区别：

1. **复杂度**：
   - `poll` 是较早引入的机制，使用起来相对简单。==它需要应用程序定期遍历==所有要监视的文件描述符，以检查它们是否准备好读取或写入。
   - `epoll` 是较新的机制，引入了事件驱动的模型。==它使用内核事件通知机制==，只在文件描述符准备好 I/O 时通知应用程序，避免了不必要的轮询。

2. **性能**：
   - `poll` 通常在监视大量文件描述符时性能较差，因为它需要应用程序轮询文件描述符来查看状态变化。
   - `epoll` 在大规模监视的情况下通常性能更好，因为它使用了事件通知机制，只在需要时通知应用程序。

3. **可扩展性**：
   - `poll` 的性能在监视大量文件描述符时会下降，因为它需要遍历所有文件描述符来查看状态变化。
   - `epoll` 可以更好地扩展到大量文件描述符，因为它使用事件驱动的模型，只在状态变化时通知应用程序。

4. **支持的事件类型**：
   - `poll` 支持多种事件类型，包括可读、可写、错误等。
   - `epoll` 也支持多种事件类型，但在某些情况下，可以更细粒度地控制事件，如边缘触发（Edge-Triggered，ET）和水平触发（Level-Triggered，LT）。

总的来说，`epoll` 更适合在大规模监视文件描述符的情况下，特别是在高性能网络编程中。

它通过使用内核事件通知机制，减少了应用程序的轮询开销，提供更好的性能和可扩展性。

但对于一些简单的应用，`poll` 可能仍然是一个合适的选择，因为它更简单易用。

不过，在大多数情况下，特别是在高性能服务器和网络应用中，`epoll` 更常见。



# 参考资料

1、Linux服务器网络开发模型

https://blog.csdn.net/21aspnet/article/details/6582021

2、

https://www.cnblogs.com/zhengAloha/p/8661762.html

