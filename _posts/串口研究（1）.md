---
title: 串口研究（1）
date: 2023-06-18 23:00:19
tags:
	- 嵌入式

---

--

# RS485和串口是什么关系

RS485（Recommended Standard 485）和串口（Serial Port）是两个相关但不完全相同的概念。

串口是一种通信接口，用于在计算机和外部设备之间进行数据传输。它通过发送和接收串行数据流来实现数据的传输，常见的串口类型包括RS232、RS422和RS485。

RS485是一种串行通信协议，它定义了在电气层面上如何进行数据传输。RS485是一种多点通信协议，允许多个设备通过单个串口进行通信。它通过差分信号传输方式，可以在较长距离上进行可靠的数据传输。

RS485与串口的关系在于，RS485可以通过串口进行实现。串口可以使用RS485协议进行通信，以满足多个设备之间的数据传输需求。常见的情况是，计算机通过串口（通常是RS232）连接到一个RS485转换器，该转换器将RS232信号转换为RS485信号，然后再连接到RS485网络上的其他设备。

总结起来，串口是一种通信接口，而RS485是一种在串口上实现的多点通信协议。RS485通过串口提供了可靠的数据传输，适用于需要在多个设备之间进行长距离通信的场景。

# RS232和RS485什么区别

RS232和RS485都是串行通信协议，常用于数据传输和通信领域。它们之间有以下几个主要区别：

1. 电气特性：RS232使用单个发送线和接收线，一般采用正负电平表示逻辑0和逻辑1。RS232通信一般采用全双工模式，即可以同时进行发送和接收。RS485使用两条平衡的发送线（A线和B线），以差分信号的形式传输数据，其中一个线路处于高电平时，另一个线路处于低电平，可以实现更好的抗干扰能力。RS485通信可以采用半双工或全双工模式。

2. 传输距离：由于电气特性的不同，RS232通常适用于较短距离的通信，最常见的距离约为50英尺（15米）。而RS485可以支持更长的传输距离，最远可达4000英尺（1200米）或更远，这使得RS485在需要远距离传输的应用中更为常见。

3. 网络拓扑：RS232通常用于点对点连接，即一对一的通信。RS485支持多点通信，可以连接多个设备在同一总线上进行通信，这使得RS485适用于多个设备之间的通信需求。

4. 传输速率：RS232通信的标准速率通常在20 kbps到115.2 kbps之间，但可以通过流控制等方式进行调整。RS485通信的标准速率通常在2 Mbps以下，但可以通过使用更高性能的芯片和调整线路参数来实现更高的速率。

总的来说，RS232适用于较短距离、点对点的通信，而RS485适用于较长距离、多设备的通信，并具有更好的抗干扰能力。选择使用哪种协议应根据具体的通信需求和系统设计来确定。

# RS485一般应用场景

RS485通信协议在许多应用场景中得到广泛应用，特别是在需要长距离传输和多设备通信的环境中。以下是一些常见的RS485应用场景：

1. 工业自动化：RS485适用于工业自动化系统中的传感器、执行器和控制器之间的通信。它可以连接多个设备，实现数据采集、监控和控制，例如工厂自动化、过程控制和机器人系统。

2. 建筑自动化：RS485常用于建筑自动化系统，用于楼宇管理、安全监控、照明控制、空调系统和访问控制等设备之间的通信。

3. 物流和仓储系统：RS485可应用于物流和仓储系统中的数据采集和设备控制，例如仓库管理系统、条码扫描设备和输送线控制。

4. 客流计数系统：在公共交通站点、商场、机场等场所，RS485可以用于客流计数系统，实现人员进出统计和流量管理。

5. 智能家居系统：RS485可用于智能家居系统中各种设备（如照明、温度控制、安防设备等）之间的通信和集成，实现智能化控制和管理。

6. 太阳能和风能系统：RS485可以用于太阳能和风能系统中的各种设备之间的数据传输，如逆变器、光伏面板和风力发电机。

7. 监控系统：RS485常用于视频监控系统中的摄像头、录像机和控制中心之间的通信，实现视频图像传输、控制和数据传输。

总的来说，RS485在需要远距离传输、多设备通信和抗干扰能力的应用场景中非常有用，特别是在工业控制、自动化和建筑领域中得到广泛应用。

# RS485典型电路

https://blog.csdn.net/u012351051/article/details/69223326

# RS485上一般运行什么协议

RS485通信协议是物理层协议，负责在RS485物理接口上实现数据的传输和收发。在RS485通信中，并没有固定的上层协议，因此可以在RS485上运行各种不同的协议，具体的选择取决于应用的需求和系统设计。

一些常见的上层协议在RS485通信中的应用包括：

1. MODBUS：MODBUS是一种常用的串行通信协议，适用于工业自动化和监控领域。它定义了数据帧的结构、功能码和通信规则，支持点对点和多点通信方式。

2. Profibus：Profibus是一种常用的工业网络通信协议，广泛应用于自动化控制系统中。它可以在RS485物理层上进行通信，并支持多个设备之间的数据传输和控制。

3. DMX512：DMX512是一种用于灯光控制和舞台设备的通信协议。它可以在RS485物理层上进行通信，并支持多个灯光设备之间的数据传输和控制。

4. RS485 Modem：RS485 Modem协议是一种用于点对点通信的简化协议，主要用于串口扩展器和串口设备之间的通信。

除了以上列举的协议，还可以根据特定的应用需求，自定义和实现适合自己系统的协议。在选择和设计上层协议时，需要考虑通信要求、数据格式、设备兼容性和系统集成等因素。

# MODBUS 介绍

MODBUS是一种串行通信协议，用于在工业自动化和监控系统中实现设备之间的通信。它是一种开放的通信协议，由MODICON（现在是施耐德电气公司的一部分）于1979年首次引入，并于2004年成为标准协议（MODBUS协议规范1.1版）。

MODBUS协议主要定义了数据帧的结构、功能码、寄存器映射和通信规则。它支持点对点通信和多点通信，可以在不同类型的通信介质上运行，如串口（如RS-232、RS-485）、以太网等。

MODBUS协议常用于工业自动化领域，例如监控和控制系统、仪器仪表、PLC（可编程逻辑控制器）、传感器、执行器和其他设备之间的通信。

MODBUS协议定义了多种功能码，用于不同类型的数据读取、写入和控制操作。常见的功能码包括：

1. 读操作：用于读取设备的状态、寄存器、输入和输出信号等。
2. 写操作：用于向设备写入数据、设置参数和执行控制操作。
3. 批量读写操作：用于一次性读取或写入多个寄存器或状态。
4. 异常处理：用于处理通信错误、设备故障或非法请求等异常情况。

MODBUS协议还定义了不同类型的数据寄存器，如线圈寄存器（用于存储开关量数据）、离散输入寄存器（用于存储输入信号状态）、保持寄存器（用于存储设备参数和数据）以及输入寄存器（用于存储输入信号的模拟值）。

总的来说，MODBUS协议简单、灵活且易于实现，已经成为工业自动化通信中最常用的协议之一。它提供了一种标准化的通信方式，使不同厂家的设备能够方便地进行数据交换和系统集成。

# modbus发展历史

MODBUS协议的发展历史可以追溯到20世纪70年代末。以下是MODBUS的主要里程碑和发展历程：

1. 1979年：MODICON（现在是施耐德电气公司的一部分）首次引入了MODBUS协议，用于其可编程逻辑控制器（PLC）产品系列。

2. 1980年：MODBUS协议第一版发布。该版本是基于串行通信的协议，使用ASCII编码。

3. 1981年：MODBUS协议第二版发布。该版本引入了基于二进制编码的通信方式，称为MODBUS RTU。

4. 1996年：MODBUS协议第三版发布。该版本是基于以太网的MODBUS协议，称为MODBUS/TCP。

5. 2004年：MODBUS协议1.1版成为标准协议。该版本对协议进行了一些修订和扩展，以更好地满足工业自动化系统的需求。

随着时间的推移，MODBUS协议得到了广泛的应用和发展，并成为工业自动化领域中最常用的通信协议之一。它的简单性、可靠性和灵活性使其受到了许多厂商和用户的青睐。

此外，由于MODBUS协议的开放性，各种厂商和组织都提供了各自的MODBUS设备和实现，使得MODBUS在不同的硬件平台和系统中都能够进行互操作。这为工业自动化系统的集成和扩展提供了便利。

# RTU是什么

RTU代表"Remote Terminal Unit"，是一种远程终端单元的通信协议格式。在工业自动化和监控系统中，RTU通常指的是基于串口通信的MODBUS RTU协议。

MODBUS RTU是一种基于二进制编码的MODBUS协议变体，使用二进制格式进行数据传输。RTU帧由固定数量的字节组成，包括从设备地址、功能码、数据字段和校验字段。

MODBUS RTU协议的特点包括：

1. 二进制编码：RTU使用二进制编码格式，每个字节由8个比特组成，可以更高效地传输数据。

2. 帧结构：RTU帧包括从设备地址、功能码、数据字段和CRC校验字段。其中，从设备地址指定要通信的设备，功能码表示执行的操作，数据字段用于传输数据，CRC校验字段用于数据完整性验证。

3. 数据封装：数据在RTU帧中以字节为单位进行封装，每个字节用8个比特表示。通常，数据字段可以包含多个寄存器的数据，寄存器的值以16位字节顺序进行编码。

4. 通信速率：RTU支持不同的通信速率，可以根据具体应用需求进行设置，常见的通信速率包括9600、19200、38400等。

RTU是MODBUS协议的一种传输格式，与MODBUS ASCII（基于ASCII编码）和MODBUS TCP（基于以太网）一起，构成了MODBUS协议的不同变体，用于在工业自动化系统中实现设备之间的通信。

# MODBUS TCP示例程序

下面是一个简单的示例程序，演示如何在C语言中使用MODBUS TCP协议与远程设备进行通信。

```c
#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>
#include <stdbool.h>
#include <string.h>
#include <unistd.h>
#include <sys/socket.h>
#include <arpa/inet.h>

#define MODBUS_TCP_PORT 502

// 函数：建立MODBUS TCP连接
int establishModbusTCPConnection(const char *ipAddress) {
    int sockfd = socket(AF_INET, SOCK_STREAM, 0);
    if (sockfd == -1) {
        perror("Failed to create socket");
        return -1;
    }

    struct sockaddr_in serverAddress;
    serverAddress.sin_family = AF_INET;
    serverAddress.sin_port = htons(MODBUS_TCP_PORT);
    serverAddress.sin_addr.s_addr = inet_addr(ipAddress);

    if (connect(sockfd, (struct sockaddr *)&serverAddress, sizeof(serverAddress)) == -1) {
        perror("Failed to connect");
        return -1;
    }

    return sockfd;
}

// 函数：发送MODBUS TCP请求帧
bool sendModbusTCPRequest(int sockfd, const uint8_t *request, int requestLength) {
    if (write(sockfd, request, requestLength) == -1) {
        perror("Failed to send request");
        return false;
    }

    return true;
}

// 函数：接收MODBUS TCP响应帧
bool receiveModbusTCPResponse(int sockfd, uint8_t *response, int *responseLength) {
    *responseLength = read(sockfd, response, *responseLength);
    if (*responseLength == -1) {
        perror("Failed to receive response");
        return false;
    }

    return true;
}

int main() {
    const char *ipAddress = "192.168.1.100";  // 设备的IP地址
    int sockfd = establishModbusTCPConnection(ipAddress);
    if (sockfd == -1) {
        return 1;
    }

    uint8_t request[] = {
        0x00, 0x01,  // 事务标识符
        0x00, 0x00,  // 协议标识符
        0x00, 0x06,  // 长度字段
        0x01,        // 单元标识符
        0x03,        // 功能码
        0x00, 0x00,  // 起始地址
        0x00, 0x0A   // 寄存器数量
    };
    int requestLength = sizeof(request);

    uint8_t response[256];
    int responseLength = sizeof(response);

    if (!sendModbusTCPRequest(sockfd, request, requestLength)) {
        close(sockfd);
        return 1;
    }

    if (!receiveModbusTCPResponse(sockfd, response, &responseLength)) {
        close(sockfd);
        return 1;
    }

    // 处理响应数据
    // ...

    close(sockfd);
    return 0;
}
```

上述示例代码使用Socket API创建TCP套接字并建立与MODBUS TCP设备的连接。然后，它构建一个MODBUS TCP请求帧并通过套接字发送。接收到的响应帧被存储在缓冲区中供后续处理。您需要根据实际情

况自行修改和扩展示例代码，包括请求帧的内容、解析响应帧的逻辑以及错误处理等。

# CH340介绍

CH340是一款USB转串口芯片，它提供了将USB接口转换为标准串口（UART）接口的功能。CH340芯片由江苏沁恒微电子有限公司设计和生产，并且被广泛用于各种电子设备和嵌入式系统中。

CH340芯片的主要特点和功能如下：

1. USB转串口功能：CH340芯片可以将USB接口转换为标准的串口（UART）接口，通过USB与计算机或其他设备进行通信。这样，设备就可以通过串口与计算机进行数据传输和通信。

2. 支持多种串口通信参数：CH340芯片支持多种串口通信参数，包括波特率、数据位、停止位、校验位等。可以根据具体应用需求进行设置和配置。

3. USB全速支持：CH340芯片支持USB 2.0规范，提供全速（12Mbps）的USB数据传输速率。这使得数据传输更快速和可靠。

4. 低功耗设计：CH340芯片采用低功耗设计，功耗较低，适合在便携设备和低功耗应用中使用。

5. 多平台支持：CH340芯片提供了广泛的操作系统和平台支持，包括Windows、Mac、Linux等。它提供了相应的驱动程序和库文件，便于在不同的系统上进行使用。

6. 多种封装和接口：CH340芯片提供了不同封装和接口选项，包括DIP、SOP、SSOP等封装形式，以及USB Type-A、USB Type-B等接口形式。这使得它可以方便地与不同的电路板和设备进行集成。

CH340芯片的出现，极大地方便了使用串口通信的设备和系统的开发和应用。它广泛应用于电子设备、嵌入式系统、工业自动化、通信设备、智能家居等领域。