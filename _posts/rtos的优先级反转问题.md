---
title: rtos的优先级反转问题
date: 2020-08-08 16:38:47
tags:
	- rtos

---

--

使用信号量会导致的另一个潜在问题是线程**优先级翻转**问题。

所谓线程优先级翻转，

即当一个高优先级线程试图通过某种互斥IPC 对象机制访问共享资源时，

如果该IPC 对象已**被一低优先级的线程所持有，**

而这个低优先级线程在运行过程中可能又被其他一些中等优先级的线程抢占，

因此造成高优先级线程被许多具有较低优先级的线程阻塞的情况。

简单来说，

A、B、C3个任务。A优先级最高，C优先级最低。

C现在拿着X这个锁。在运行。

A现在需要X这个锁。所以A被阻塞了。

B不需要X这个锁，B优先级比C高，所以B抢占了C。

这样看起来，A和B的优先级就反转了。

**优先级翻转会造成高优先级线程的实时性得不到保证。**



在RT-Thread 中，通过互斥量的优先级继承算法，可以有效地解决优先级翻转问题。



**优先级继承是指提高某个占有某种共享资源的低优先级线程的优先级，使之与所有等待该资源的线程中优先级最高的那个线程的优先级相等**，

从而得到更快的执行然后释放共享资源，而当这个低优先级线程释放该资源时，优先级重新回到初始设定值。

例如，就把C的优先级提高到跟A一样高，这样B就无法抢占C（C优先级已经比B高了）。

所以C可以尽快运行完，然后释放锁。让A去运行。



参考资料

1、RT-Thread 内核学习 >> （十一）线程的优先级翻转

https://blog.csdn.net/weixin_40973138/article/details/89066884