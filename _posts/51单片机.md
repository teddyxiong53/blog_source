---
title: 51单片机
date: 2023-05-30 11:04:11
tags:
	- 电路
---

--

现在要研究一下芯片，51单片机是一个很好的切入点，因为简单。

以下是一些与51单片机相关的开源项目，你可以在GitHub上找到它们：

1. SDCC（Small Device C Compiler）：一个开源的ANSI-C编译器，支持多种嵌入式平台，包括51单片机。项目链接：https://github.com/sdcc/sdcc，（地址实际在这里：https://github.com/darconeous/sdcc/）已经废弃的项目了。但是可以研究一下。

2. C51开发套件（C51 Development Kit）：一个集成开发环境（IDE），用于编写、编译和调试51单片机的程序。项目链接：https://github.com/vancegroup-mirrors/c51-devkit （没有）

3. Arduino Core for 8051（51系列单片机的Arduino核心）：将51单片机与Arduino开发环境集成，使得使用Arduino语法和库函数更加方便。项目链接：https://github.com/MCUdude/MajorCore

4. 8051模拟器（8051 Simulator）：一个用于模拟和调试51单片机程序的开源工具，提供了类似硬件运行环境的功能。项目链接：http://www.edsim51.com/

这些项目提供了与51单片机开发相关的工具、库和示例代码，你可以通过浏览它们的GitHub页面，了解更多关于它们的信息，并下载和使用相应的资源。请注意，我无法保证这些项目的完整性、可靠性或最新性，建议你在使用时仔细审查和测试项目代码。



针对small device的arduino实现。

https://github.com/tenbaht/sduino

Python 51模拟器，就一个文件。

https://github.com/mucan54/8051-simulator

js写的51模拟器。

https://github.com/sid-maddy/8051.js

# 指令集

https://www.cnblogs.com/gh110/p/15869257.html

- MCS-51系列单片机指令系统共有111条指令。

> 按功能分为5类：①数据传送（29条）②算术运算（24条）③逻辑运算（24条）④控制转移（17条）⑤布尔处理（17条）

> 按字节长度分为3类：①单字节指令（49条）②双字节指令（46条）③三字节指令（只有16条）

> 按执行时间分为3类：①单机器周期指令（64条）②双机器周期指令（45条）③四机器周期指令（只有2条）

- MCS-51单片机指令系统的特点：
  - ① 助记符少：MCS-51指令系统用44种助记符表示了33种指令功能。
  - ②空间和时间效率均较高：平均指令长度和平均指令执行时间短。
  - ③更适合于实时控制： MCS-51指令系统中有17条布尔处理指令。

## 寄存器寻址

- 寻址空间：R0～R7，A、B、Cy（位），DPTR（这个就是DPH和DPL这2个寄存器组成，在0x82和0x83这个位置）。



# 51单片机的地址空间范围是多少？最大可以适应多大的flash和sram

在MCS-51（8051）单片机中，地址空间范围和最大支持的Flash和SRAM大小受架构的限制。以下是具体的情况：

### 地址空间范围

| 类型                            | 地址范围                          | 最大空间                |
| ------------------------------- | --------------------------------- | ----------------------- |
| **片内程序存储器（ROM/Flash）** | 16位地址总线：`0x0000` - `0xFFFF` | **64KB**                |
| **片内数据存储器（SRAM）**      | 8位地址总线：`0x00` - `0xFF`      | **256字节**（直接寻址） |
| **外部数据存储器（外部RAM）**   | 16位地址总线：`0x0000` - `0xFFFF` | **64KB**                |
| **特殊功能寄存器（SFR）**       | 8位地址总线：`0x80` - `0xFF`      | **128字节**（上半区）   |

### 详细解释

1. **片内程序存储器（ROM/Flash）**：
   - MCS-51单片机使用16位地址总线寻址片内或片外程序存储器，地址范围为`0x0000`到`0xFFFF`，即最大可支持**64KB**的ROM或Flash。
   - 对于典型的8051芯片，如果片内程序存储器不足，可以使用外部ROM或Flash扩展。

2. **片内数据存储器（SRAM）**：
   - 内部数据存储器的直接寻址范围为`0x00`到`0xFF`，即**256字节**。其中，前128字节（`0x00`到`0x7F`）用于通用数据存储，后128字节（`0x80`到`0xFF`）用于特殊功能寄存器（SFR）。
   - 有些8051变种芯片提供更多的片内SRAM，但标准8051芯片仅支持256字节。

3. **外部数据存储器（外部RAM）**：
   - 通过16位地址总线访问，MCS-51可以连接最多**64KB**的外部数据存储器。
   - 外部RAM通常通过`MOVX`指令进行访问，用于扩展内存。

### 最大支持的Flash和SRAM

- **Flash（程序存储器）**：
  - 最大支持64KB的片内或外部Flash。
  - 实际的Flash大小取决于具体的芯片型号，有些现代8051兼容芯片支持更大的Flash容量，如128KB或更高。

- **SRAM（数据存储器）**：
  - 内部SRAM最大为256字节（标准8051）。
  - 通过外部扩展，最大可支持64KB的SRAM。

### 结论
标准MCS-51架构支持64KB的程序存储空间（Flash/ROM）和64KB的外部数据存储空间（SRAM）。内部数据存储器则被限制在256字节的范围内。如果你需要更大的存储空间，可以考虑使用扩展内存或选择现代的8051兼容芯片。

# movx指令使用举例

`MOVX`指令在MCS-51（8051）单片机中用于访问外部数据存储器（通常是外部RAM）。它通过16位地址总线进行操作，能够访问多达64KB的外部数据存储器空间。

### `MOVX`指令的基本格式

```asm
MOVX A, @DPTR    ; 从DPTR指向的外部地址加载数据到累加器A
MOVX A, @Ri      ; 从Ri（R0或R1）指向的外部地址加载数据到累加器A
MOVX @DPTR, A    ; 将累加器A中的数据存储到DPTR指向的外部地址
MOVX @Ri, A      ; 将累加器A中的数据存储到Ri（R0或R1）指向的外部地址
```

### 示例 1：使用`DPTR`访问外部RAM

假设你有一个外部RAM，想要读取和写入数据。以下是使用`MOVX`指令的一个示例：

```asm
MOV DPTR, #0x1234  ; 设置DPTR为外部RAM地址0x1234
MOV A, #0x56       ; 将数据0x56放入累加器A
MOVX @DPTR, A      ; 将累加器A的内容（0x56）存储到外部RAM地址0x1234

MOV DPTR, #0x1234  ; 重新设置DPTR为外部RAM地址0x1234
MOVX A, @DPTR      ; 从外部RAM地址0x1234加载数据到累加器A
```

- **第一步**：设置数据指针寄存器`DPTR`为目标地址`0x1234`。
- **第二步**：将数据`0x56`加载到累加器A。
- **第三步**：使用`MOVX @DPTR, A`将累加器中的数据写入到外部RAM的`0x1234`地址。
- **第四步**：再次设置`DPTR`为目标地址，然后从该地址读取数据并存储在累加器A中。

### 示例 2：使用寄存器`R0`或`R1`访问外部RAM

如果你希望使用寄存器`R0`或`R1`来访问外部RAM，可以使用如下指令：

```asm
MOV R0, #0x30    ; 设置R0为外部RAM的低字节地址
MOV A, #0x78     ; 将数据0x78放入累加器A
MOVX @R0, A      ; 将累加器A的内容存储到外部RAM地址0x0030

MOVX A, @R0      ; 从外部RAM地址0x0030加载数据到累加器A
```

- **第一步**：将`R0`设置为外部RAM的目标地址低字节（`0x0030`）。
- **第二步**：将数据`0x78`加载到累加器A。
- **第三步**：使用`MOVX @R0, A`将累加器中的数据写入到外部RAM的`0x0030`地址。
- **第四步**：再次从该地址读取数据并存储在累加器A中。

### 注意事项
- **DPTR**是一个16位的寄存器，通常用于指向外部存储器中的数据地址。
- **R0**和**R1**是8位寄存器，所以在使用它们作为地址指针时，只能访问外部RAM的低256字节（即地址范围`0x0000`到`0x00FF`）。
- `MOVX`指令通常用于与外部总线连接的外部RAM或I/O设备通信。

通过这些示例，你可以看到如何使用`MOVX`指令访问外部数据存储器并在8051系统中进行数据传输。



# sdcc的mcs51汇编

https://www.cnblogs.com/milton/p/15837152.html

## 常用寄存器

- A (累加器)
- B, R0, R1, R2, R3, R4, R5, R6, R7 在函数中使用的变量, R0-R7是变量, 地址并非唯一, 其绝对地址由AR0-AR7指定.
- DPTR(data pointer), PC(program counter) 这两个都是16位双字节寄存器
  - PC 指向下一个指令的地址, 16位宽度, 因此代码区的最大范围为0 - 0xFFFF, 64K字节
  - 8051启动时, PC值为0x0000, 从代码区0x0000开始执行第一条指令
- SP 栈顶指针, 其值为堆栈栈顶的地址, SDCC中, 堆栈的地址是向上增长的, 这个与常见的向下增长不同
- BP 基址指针寄存器BP(base pointer), 和堆栈指针SP联合使用, 使用BP把SP的值传递给BP, 通过BP来寻找堆栈里数据或者地址.

### 程序状态寄存器 PSW

其中的6个位是预先定义的, 分别为

- CY 最高位进位标志位, 当加法等运算结果超过0xFF, 产生进位时, 这个bit会被置1
- AC D3 至 D4 进位标志位, 当加法等运算低四位产生仅位时, 这个bit会被置1
- F0
- RS1 寄存器组选择, RS1,RS0的组合对应的选择为
- RS0 寄存器组选择: 0,0:bank0, 0,1:bank1, 1,0:bank2, 1,1:bank3
- OV 溢出标志位
- \--
- P 奇偶校验位, 如果在寄存器A中的, 1的个数为偶数时这个bit为0, 1的个数为奇数时这个bit为1

### 内存结构

8051的基础内存为128字节, 地址为00H - 7FH, 这128字节被分成三组

1. 00H - 1FH, 32个字节, 用于寄存器组和堆栈
   - 这32个字节被分成4组(4 banks), 每组8个寄存器R0-R7
   - 当8051加电时, 默认使用寄存器组0(bank 0)
   - 通过PWS的D4,D3选择
   - 栈顶地址存储在SP寄存器
   - SP寄存器只有8位, 因此其范围只有00H-FFH
   - 当8051加电时, SP寄存器的值为07, 因此内存地址08H就是堆栈的第一个地址, 这个地址与寄存器组1是重合的
   - 可以给堆栈指定其它的地址
   - PUSH操作时, SP会加1, 向上增长
   - POP操作时, SP减1, 向下收缩
2. 20H - 2FH, 16个字节用于可以按位寻址内存访问
3. 30H - 7FH, 80个字节属于通用内存(scratch pad)