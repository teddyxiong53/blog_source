---
title: java之反射
date: 2019-04-03 13:21:04
tags:
	- java

---



java为什么可以反射？

反射依赖编译器为class生成的元信息。

运行时类型识别（RTTI）。

靠的就是编译时，对每一个定义的java类，都有一个对应的Class对象。



反射最重要的用途就是开发各种通用框架。



java中出现RRTI的说法则是源于《Thinking in Java》一书，

其作用是在运行时识别一个对象的类型和类的信息，

这里分两种：

传统的”RRTI”,它假定我们在**编译期**已知道了所有类型(在没有反射机制创建和使用类对象时，一般都是编译期已确定其类型，如new对象时该类必须已定义好)，

另外一种是反射机制，它允许我们**在运行时**发现和使用类型的信息。

在Java中**用来表示运行时类型信息的对应类就是Class类**，Class类也是一个实实在在的类，存在于JDK的java.lang包中



前面我们已提到过，Class对象是由JVM加载的，那么其加载时机是？

实际上所有的类都是在对其第一次使用时动态加载到JVM中的，

当程序创建第一个对类的静态成员引用时，就会加载这个被使用的类(实际上加载的就是这个类的字节码文件)，

注意，使用new操作符创建类的新实例对象也会被当作对类的静态成员的引用(构造函数也是类的静态方法)，

由此看来Java程序在它们开始运行之前**并非被完全加载**到内存的，

其各个部分是**按需加载**，

所以在使用该类时，类加载器首先会检查这个类的Class对象是否已被加载(类的实例对象创建时依据Class对象中类型信息完成的)，

如果还没有加载，默认的类加载器就会**先根据类名查找.class文件**

(编译后Class对象被保存在同名的.class文件中)，

在这个类的字节码文件被加载时，它们必须接受相关验证，

以确保其没有被破坏并且不包含不良Java代码(这是java的安全机制检测)，

完全没有问题后就会被动态加载到内存中，

此时相当于Class对象也就被载入内存了(毕竟.class字节码文件保存的就是Class对象)，同时也就可以被用来创建这个类的所有实例对象。



相信很多人都知道反射可以说是Java中最强大的技术了，它可以做的事情太多太多，

很多优秀的开源框架都是通过反射完成的，

比如最初的很多注解框架，

后来因为java反射影响性能，所以被运行时注解APT替代了，

java反射有个开源框架jOOR相信很多人都用过，

不过我们还是要学习反射的基础语法，这样才能自己写出优秀的框架，

当然这里所讲的反射技术，是学习Android插件化技术、Hook技术等必不可少的！



基本的反射

通过实例获得Class。

```
String name = "xxx";
Class cl = name.getClass();
println(cl.getName());
```

用类的字符串名字来得到Class。

```
String name = "java.lang.String";
Class cl = null;
cl = Class.forName(name);//可能抛出ClassNotFoundException。
println(cl.getName());
```



参考资料

1、Java为什么要有反射机制，而 C++ 没有？

https://www.zhihu.com/question/42098040

2、深入理解Java类型信息(Class对象)与反射机制

https://blog.csdn.net/javazejian/article/details/70768369

3、说说反射的用途及实现

https://www.jianshu.com/p/d6035d5d4d12