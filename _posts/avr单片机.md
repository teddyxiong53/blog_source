---
title: avr单片机
date: 2023-05-28 21:41:11
tags:
	- 嵌入式
---

--

# 为什么研究avr

因为arduino使用了avr。

而且我发现国外很多优质的avr资料。

例如我希望重点研究的这个仿真器：

https://github.com/buserror/simavr

https://github.com/SimulIDE/SimulIDE

所以有必要把avr研究透彻。

而且在proteus里也很方便做实验。

# avr名字由来

Alf and Vegard’s Risc processor (AVR) 

是2个作者名字的首字母，加Risc的首字母。

# avr单片机历史

AVR（Advanced Virtual RISC）是一系列基于RISC架构的8位和32位微控制器单片机（MCU）产品系列，由Atmel（现在为Microchip Technology）公司开发和推出。以下是AVR单片机的历史概述：

- 1996年：Atmel公司推出了第一款AVR单片机，名为AT90S1200。它采用8位RISC架构，运行速度快，具有较低的功耗和成本，并且集成了闪存存储器。

- 1997年：Atmel发布了更高性能的AVR单片机，包括AT90S2313和AT90S8515。这些单片机具有更大的闪存存储器容量和更多的输入/输出引脚，适用于更复杂的应用。

- 2002年：Atmel发布了AVR单片机的新一代产品线，包括ATmega系列和ATtiny系列。ATmega系列是高性能的8位AVR单片机，提供了更大的闪存、RAM和更多的外设接口。ATtiny系列则是低功耗的AVR单片机，适用于电池供电和资源受限的应用。

- 2008年：Atmel推出了32位AVR单片机产品线，命名为AVR32。这些单片机基于32位RISC架构，运行速度更快，具有更大的存储器容量和更丰富的外设接口，适用于高性能应用。

- 2010年：Atmel推出了AVR XMEGA系列，这是AVR单片机的另一个新系列。AVR XMEGA单片机具有更多的闪存、RAM和外设接口，同时支持更高的时钟速度和更低的功耗。

随着时间的推移，AVR单片机逐渐发展壮大，并广泛应用于各种领域，包括消费电子、工业自动化、通信、医疗设备等。它们以其易用性、高性能、低功耗和丰富的外设接口而闻名，成为嵌入式系统开发的重要选择之一。

# avr和51单片机比较

AVR（Advanced Virtual RISC）和8051是两种常见的8位单片机架构，它们在设计和特性上有一些区别。以下是AVR和8051单片机的比较：

1. **架构和指令集**：
   - AVR：AVR采用Harvard架构，即数据存储器和程序存储器分开，可以同时访问。它使用精简指令集（RISC），指令集简单且统一，执行速度较快。
   - 8051：8051采用von Neumann架构，即数据存储器和程序存储器共享同一地址空间。它使用CISC（Complex Instruction Set Computer）指令集，指令集较为复杂。

2. **性能和时钟速度**：
   - AVR：AVR单片机通常具有较高的性能和较快的时钟速度，以及更高的指令执行效率。
   - 8051：8051单片机在性能和时钟速度方面相对较低，适用于一些低要求的应用场景。

3. **存储器容量**：
   - AVR：AVR单片机通常具有较大的闪存和RAM容量，可以容纳更多的程序代码和数据。
   - 8051：8051单片机的闪存和RAM容量相对较小，适用于一些简单的应用。

4. **外设接口和扩展性**：
   - AVR：AVR单片机通常具有丰富的外设接口和扩展性选项，可以连接更多的外部设备和传感器。
   - 8051：8051单片机的外设接口相对较少，扩展性有限，适用于一些简单的控制任务。

5. **开发工具和生态系统**：
   - AVR：AVR拥有广泛的开发工具和支持，包括编译器、调试器、仿真器等。同时，有丰富的开源项目和社区支持。
   - 8051：8051也有许多成熟的开发工具和支持，尤其在传统的嵌入式系统领域应用较广。

选择使用AVR还是8051单片机取决于具体的应用需求。AVR在性能、指令集和存储器容量方面具有一些优势，适用于需要较高性能和更复杂功能的应用。8051单片机在一些简单的控制任务和资源受限的应用中仍然被广泛使用，尤其是在一些传统的嵌入式系统和低成本项目中。

# arduino为什么使用avr单片机

Arduino使用AVR单片机作为其主要控制器，有以下几个原因：

1. **开源性和易用性**：Arduino是一种开源硬件平台，旨在提供简单易用的开发工具和环境。AVR单片机具有较简单的架构和易于编程的指令集，使得它们非常适合初学者和非专业开发者使用。Arduino提供了友好的开发环境和丰富的库函数，使得使用AVR单片机进行开发变得简单和便捷。

2. **低成本和广泛可用性**：AVR单片机的成本相对较低，并且在市场上广泛可得。这使得Arduino开发板的价格相对较低，可以轻松购买和使用。此外，由于AVR单片机的广泛使用，有大量的资源、文档和社区支持可供参考和学习。

3. **性能和资源适配**：AVR单片机在低功耗和小型封装方面表现优秀。它们适用于许多嵌入式系统和物联网应用，尤其是那些对功耗和空间有限的项目。AVR单片机的资源（如闪存和RAM容量）通常足够满足许多简单到中等复杂度的项目需求。

4. **可扩展性和生态系统**：Arduino平台提供了丰富的扩展模块和传感器，可以方便地与AVR单片机进行连接。此外，由于Arduino的广泛普及，有许多第三方厂商和社区开发了各种扩展模块和库函数，使得用户能够更轻松地构建各种项目。

尽管Arduino最初选择了AVR单片机作为其主要控制器，但它也支持其他类型的微控制器，如ARM架构的SAM系列和ESP8266/ESP32等。这样的扩展使得Arduino适应了更广泛的应用需求和技术趋势。

# avr单片机在国内用得多吗

AVR单片机在国内曾经是非常流行和广泛使用的。在过去的几十年中，AVR单片机在中国嵌入式系统和电子产品制造业中扮演了重要的角色。许多中国的学校、大学和研究机构也使用AVR单片机作为教学和研究的平台。

以下是一些导致AVR单片机在中国使用广泛的原因：

1. **成本效益**：AVR单片机的成本相对较低，这对于中国的制造业和学术机构来说是一个重要的考虑因素。低成本的AVR单片机使得它们在中国市场上广泛可得，并被大量采用。

2. **易用性和开发环境**：AVR单片机配备了友好的开发环境和工具链，如Atmel Studio和Arduino IDE。这些工具提供了一套简单易用的接口和库函数，使得初学者和非专业开发者能够快速上手并进行开发。这对于中国的教育机构和初学者来说非常有吸引力。

3. **丰富的资源和社区支持**：由于AVR单片机在全球范围内使用广泛，有大量的中文文档、教程和社区资源可供参考。中国有着庞大的开源社区，提供了丰富的AVR相关资源，使得开发者能够更轻松地获取支持和解决问题。

然而，随着时间的推移，其他单片机架构（如ARM Cortex-M系列）的兴起以及中国国内市场的变化，AVR单片机在中国的使用情况可能有所变化。一些更高性能、低功耗的单片机架构在特定应用领域中得到了更多的应用，但AVR单片机仍然是一种可靠、易用且经济实惠的选择，特别是在一些中小型项目和教育领域。

# avr单片机典型型号介绍

AVR单片机系列中有许多不同的型号和系列，每个型号都有其特定的功能和应用领域。以下是几个常见的AVR单片机型号的简要介绍：

1. **ATmega328P**：这是非常常见和广泛使用的AVR单片机型号，它是Arduino Uno开发板的核心芯片。ATmega328P具有32KB闪存存储器、2KB SRAM和1KB EEPROM，适用于各种简单到中等复杂度的项目。

2. **ATmega2560**：这是另一个常见的AVR单片机型号，它是Arduino Mega 2560开发板的主控芯片。ATmega2560具有256KB闪存存储器、8KB SRAM和4KB EEPROM，具备更大的存储容量和更多的输入/输出引脚，适用于需要更多资源和扩展性的项目。

3. **ATtiny85**：这是一款低功耗的AVR单片机，常用于电池供电和资源受限的应用。它具有8KB闪存存储器、512B SRAM和512B EEPROM，尺寸小巧，适用于一些简单的控制任务和小型项目。

4. **ATmega32U4**：这是一款支持USB接口的AVR单片机，常用于键盘、鼠标和游戏手柄等USB设备的控制。ATmega32U4具有32KB闪存存储器、2.5KB SRAM和1KB EEPROM，同时具备USB功能，方便与计算机进行通信和交互。

5. **ATtiny2313**：这是一款低成本的AVR单片机，适用于一些简单的控制和嵌入式系统应用。ATtiny2313具有2KB闪存存储器、128B SRAM和128B EEPROM，尺寸小巧且易于集成。

需要注意的是，以上只是几个典型的AVR单片机型号，实际上AVR系列有更多不同型号和系列可供选择，以满足不同的应用需求。具体选择合适的AVR单片机应基于项目需求、功能要求、资源需求和成本等因素进行评估。

# avr指令集介绍

AVR 微控制器的指令集是其计算机体系结构的基础，它包括一组可用于执行各种操作的机器指令。AVR 微控制器的指令集是 RISC（精简指令集计算机）架构的一个示例，具有相对较小但高度优化的指令集，用于执行常见的微控制器任务。以下是 AVR 微控制器常见的指令集：

1. **数据传送指令：**
   - `MOV`：将一个寄存器的值复制到另一个寄存器。
   - `LD` 和 `ST`：用于从存储器（RAM）中加载数据到寄存器，以及将数据存储回存储器。

2. **算术和逻辑操作指令：**
   - `ADD` 和 `SUB`：用于执行加法和减法操作。
   - `AND`、`OR`、`EOR`：用于进行位与、位或和位异或操作。
   - `LSR` 和 `LSL`：用于逻辑右移和逻辑左移。
   - `INC` 和 `DEC`：用于增加和减少寄存器的值。

3. **条件分支指令：**
   - `BRxx`：条件分支指令，根据特定的条件执行分支。

4. **循环指令：**
   - `RJMP` 和 `RCALL`：用于相对跳转和子程序调用。
   - `CPSE`：用于比较并跳过（如果条件成立）。

5. **堆栈操作指令：**
   - `PUSH` 和 `POP`：用于堆栈的数据推入和弹出。

6. **I/O 操作指令：**
   - `IN` 和 `OUT`：用于输入和输出寄存器的值。

7. **位操作指令：**
   - `SBI` 和 `CBI`：用于设置位和清除位。

8. **中断操作指令：**
   - `SEI` 和 `CLI`：用于打开和关闭中断。

这只是 AVR 指令集中的一小部分。AVR 微控制器的具体型号可能会有一些额外的指令或微架构特定的指令。程序员可以根据需要使用这些指令来编写 AVR 微控制器的汇编语言程序。在编程 AVR 微控制器时，通常会使用汇编语言或高级语言（如C）来编写程序，并将其编译成机器码以加载到微控制器中执行。

# datasheet

https://ww1.microchip.com/downloads/en/DeviceDoc/Atmel-7810-Automotive-Microcontrollers-ATmega328P_Datasheet.pdf

以atmega328p为例，对avr单片机进行基本的了解。

131条指令，大部分都是单周期的指令。

32个8位的通用寄存器。

16MHz的主频。

32K的flash。1K的eeprom（寿命1万次）。2K的SRAM（寿命10万次）。

可选的boot。

2个8bit的timer。

1个16bit的timer。

6个pwm。

8通道的10bit adc。

uart。spi。i2c。看门狗。外部中断和wakeup。

6种sleep mode：

封装：32个pin。其中23个可编程的pin。

工作电压：2.7到5.5V。

温度：-40到125度。

gpio：

PB0到PB7：

8bit的双向io口，有内部上拉。

PC0到PC5：

7bit的双向io口，有内部上拉。

PC6：这个复用为RESET引脚。

PD0到PD7：

8bit的双向io口，有内部上拉。

对应模拟器里的头文件：

src\simavr\cores\avr\iom328p.h

# avr可选的boot

在 AVR 微控制器中，Boot Loader（引导加载程序）是一种可选的功能，允许用户通过通信接口（例如串口或USB）更新微控制器的固件或程序，而无需使用专用的编程器硬件。

以下是 AVR 微控制器中可选的 Boot Loader 特性：

1. **Boot Section Size Configuration：** AVR 微控制器通常将程序存储器（Flash）分成两个部分，一个用于应用程序，另一个用于引导加载程序。用户可以配置这两个部分的大小，以满足其特定需求。通常，引导加载程序部分较小，用于存储引导加载程序代码，而应用程序部分用于存储用户的应用程序。

2. **Boot Vector Location：** AVR 微控制器的引导加载程序代码的入口点由引导加载程序矢量的位置确定。用户可以选择将引导加载程序矢量放置在不同的位置，以控制在不同情况下引导加载程序是否会运行。

3. **Boot Reset Fuse (BOOTRST)：** 通过配置复位熔丝位 (BOOTRST)，用户可以选择在复位时是否进入引导加载程序模式。如果设置了 BOOTRST，复位后将进入引导加载程序模式，否则将启动应用程序。

4. **Communication Interface：** 用户可以选择使用哪种通信接口来与引导加载程序进行通信。常见的选择包括串口通信（USART），USB通信，以太网通信等。这取决于微控制器的型号和可用的硬件资源。

5. **Boot Loader Commands：** 引导加载程序通常支持一组特定的命令，用于擦除 Flash 存储器、写入新的固件、读取固件版本等操作。用户可以通过发送这些命令来与引导加载程序进行交互。

6. **Security and Verification Features：** 一些 AVR 微控制器的引导加载程序支持固件验证和签名，以确保只有经过验证的固件才能被加载和执行。这有助于提高固件的安全性。

引导加载程序通常用于在设备已经部署并运行的情况下，通过远程更新的方式来更新设备的固件。这在嵌入式系统中非常有用，因为它允许远程修复漏洞、添加新功能或改进性能，而无需物理接触设备。

具体的引导加载程序特性和配置选项可能因 AVR 微控制器型号而异，因此在使用引导加载程序功能时，需要查阅特定微控制器型号的数据表和手册以获取详细的信息。

#  avr-libc

`avr-libc` 是一个用于 AVR 微控制器的标准C库。它提供了一组C库函数，使开发者能够以C语言编程方式开发嵌入式系统，并充分利用AVR架构的功能。`avr-libc`是一个开源项目，可以在自由软件许可下使用，因此它广泛用于嵌入式系统和嵌入式开发中。

以下是 `avr-libc` 的一些主要特点和功能：

1. **标准C库函数：** `avr-libc` 实现了标准C库函数，如字符串操作、数学运算、文件操作等，使开发者能够以C语言编程方式开发嵌入式应用程序。

2. **针对AVR体系结构的优化：** `avr-libc` 中的函数经过优化，以充分利用AVR微控制器的特性和指令集。这些优化包括对寄存器操作的支持以及对低级硬件功能的访问。

3. **嵌入式系统支持：** `avr-libc` 提供了许多函数和宏，用于访问和配置AVR微控制器的寄存器和硬件模块。这使开发者能够轻松地编写与硬件交互的代码。

4. **中断支持：** AVR微控制器通常使用中断来处理异步事件。`avr-libc` 提供了用于编写中断处理程序的函数和宏，以及与中断相关的功能。

5. **串口、定时器和其他外设支持：** AVR微控制器通常具有各种外设，如串口通信、定时器、ADC（模数转换器）等。`avr-libc` 包含了许多函数和宏，以简化对这些外设的访问和配置。

6. **浮点数支持（可选）：** `avr-libc` 可以配置以包含浮点数支持。这对于执行浮点运算的应用程序很有用。

7. **支持多种编译器：** `avr-libc` 支持多种编译器，包括GNU GCC和其他AVR开发工具链中的编译器。

8. **开源和社区支持：** 作为一个开源项目，`avr-libc` 受到了广泛的社区支持和贡献。开发者可以参与到项目中，共同改进和扩展库的功能。

`avr-libc` 在AVR微控制器的嵌入式系统开发中扮演了重要的角色，它为开发者提供了一个稳定、高效的C库，使他们能够更容易地开发嵌入式应用程序，从而加速了产品的开发周期。

主页：

https://www.nongnu.org/avr-libc/

到这里下载代码：

http://download.savannah.gnu.org/releases/avr-libc/

代码没有太多值得研究的，知道有这么个东西存在就好了。

