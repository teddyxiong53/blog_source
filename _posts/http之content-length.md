---
title: http之content-length
date: 2020-08-03 11:44:47
tags:
	- http

---

1

主体的字节大小。这个大小是包含了所有内容编码的，比如，对文本文件进行了 gzip 压缩的话，Content-Length 首部就是压缩后的大小，而不是原始大小。

使用 Content-Length 首部是为了能够检测出服务器崩溃而导致的报文截尾，**并对共享持久连接的多个报文进行正确分段。**

错误的 Content-Length 比缺少 Content-Length 还要糟糕。因为某些早期的客户端和服务器在 Content-Length 计算上存在一些众所周知的错误，有些客户端、服务器以及代理中就包含了特别的算法，用来检测和纠正与有缺陷服务器的交互过程。



**Content-Length 首部对于持久连接是必不可少的。**

如果响应通过持久连接传送，就可能有另一条 HTTP 响应紧随其后。

**客户端通过 Content-Length 首部就可以知道报文在何处结束，下一条报文从何处开始。**

因为连接是持久的，客户端无法依赖连接关闭来判别报文的结束。



采用**分块编码**(chunked encoding)时，使用持久连接时**可以没有** Content-Length 首部。

在分块编码的情况下，数据是分为一系列的块来发送的，每块都有大小说明。

哪怕服务器在生成首部的时候不知道整个实体的大小(通常是因为实体是动态生成的)，仍然可以使用分块编码传输若干已知大小的块。



下面列出的规则说明了在若干不同的情况下如何正确计算主体的长度和结束位置。这些规则应当按顺序应用，谁先匹配就用谁： 

```

```



content-length只对post请求有用。是post的body部分的长度。

不包含header的长度。

post必须要有content-length。保险起见，自己计算这个长度。



参考资料

1、Content-Length 实体的大小

https://blog.csdn.net/gogzf/article/details/78393325