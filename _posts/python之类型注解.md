---
title: python之类型注解
date: 2022-11-13 15:20:32
tags:
	- Python

---

--

typing是python3.5开始新增的用于类型注解的模块。

作用是为python提供静态类型检查。

typing这个模块内部常用的类型有：

* Any
* Union
* Tuple
* Callable
* TypeVar
* Optional
* Generic

typing模块虽然已经加入到标准库里，但是如果核心开发者认为有必要，api可能会发生变化，也就是不保证向后的兼容性。

# 学习步骤

学习 Python 的类型注解是一个很好的选择，特别是对于大型项目和团队合作来说更是如此。

下面是一个简单的指南，以帮助您系统地学习 Python 的类型注解：

| 步骤 | 内容                                                         |
| ---- | ------------------------------------------------------------ |
| 1    | **了解类型注解的基础**：<br>学习类型注解的基本概念和语法。理解如何为变量、函数参数和返回值添加类型注解。Python 官方文档和 PEP 484 提供了很好的起点。 |
| 2    | **掌握类型提示的语法**：<br>熟悉常见的类型提示语法，包括基本类型（如 int、str、bool）、列表、字典、元组等容器类型以及自定义类的注解。 |
| 3    | **了解类型注解工具**：<br>探索 Python 中常用的类型注解工具，如 `mypy`、`pyright` 和 `pylint`。了解它们的优缺点以及如何集成到您的开发工作流程中。 |
| 4    | **深入理解类型系统**：<br>学习 Python 中的类型系统，包括静态类型和动态类型的区别，以及类型推断的原理。这将帮助您更好地理解类型注解的作用和限制。 |
| 5    | **实践应用**：<br>通过实际项目或练习来应用您所学到的知识。尝试为现有的 Python 项目添加类型注解，或者创建新项目并从一开始就使用类型注解。 |
| 6    | **学习进阶内容**：<br>深入研究类型注解的高级话题，如泛型、类型别名、协变与逆变等。这些内容将进一步提高您对类型注解的理解和应用水平。 |
| 7    | **持续学习与实践**：<br>类型注解是一个不断发展的领域，保持学习状态并不断尝试新的技术和工具将有助于您不断提高。参与社区讨论、阅读相关的博客和文档，以及与其他开发者分享经验也是很好的学习方式。 |

# 发展过程

类型注解在 Python 中的发展经历了一系列的阶段，让我们来看一下主要的里程碑：

| 时间段 | 里程碑                                                       |
| ------ | ------------------------------------------------------------ |
| 2006年 | **PyCon keynote by Guido van Rossum**：<br>在 PyCon 大会上，Guido van Rossum提出了一种对Python添加静态类型的想法，并表示愿意看到类型提示被添加到Python中。 |
| 2014年 | **PEP 484 (Type Hints)**：<br>由 Guido van Rossum 和 Jukka Lehtosalo 联合撰写的 PEP 484 提案被提出，该提案引入了类型提示的概念，并建议使用类型注解来指定函数的参数和返回值类型。 |
| 2015年 | **mypy 项目**：<br>由 Jukka Lehtosalo 开始的 mypy 项目成为了一个流行的静态类型检查器，它支持 PEP 484 中定义的类型提示语法，并可以在代码中执行静态类型检查。 |
| 2016年 | **Python 3.5 发布**：<br>Python 3.5 成为了第一个正式支持类型提示语法的版本，这是在 Guido van Rossum 和社区的积极推动下实现的。 |
| 2017年 | **PEP 526 (Syntax for Variable Annotations)**：<br>PEP 526 引入了变量注解的语法，允许在变量声明时添加类型注解，从而使得类型提示更加灵活和可读。 |
| 2019年 | **PEP 544 (Protocols: Structural subtyping (static duck typing))**：<br>PEP 544 引入了协议（protocols）的概念，这是一种结构化子类型系统，允许在不引入新的基类的情况下进行静态类型检查。 |
| 至今   | **持续的发展和改进**：<br>类型提示和类型注解在 Python 社区中持续发展和改进，新的 PEP 提案和工具不断涌现，为 Python 开发者提供了更好的类型支持和工具。 |

通过这些里程碑，类型注解逐渐成为 Python 开发中的重要工具之一，为代码的可读性、可维护性和可靠性做出了重要贡献。

# 基本类型注解和typing里的类型注解是什么关系

基本类型注解和 `typing` 模块中的类型注解都是用于指定变量、函数参数和返回值的类型的工具，但它们在一定程度上有所不同。

基本类型注解通常是指在 Python 3.5 及以上版本中引入的==原生类型提示，==

它们包括了 Python 中的基本数据类型，

比如 `int`、`str`、`float`、`bool` 等，

以及一些特殊的类型，比如 `None` 和 `Any`。

==这些基本类型注解直接由 Python 解释器识别和处理。==



而 `typing` 模块中的类型注解提供了更丰富、更灵活的类型提示，

它可以用于描述更复杂的数据结构，

比如列表、字典、元组、集合等，

以及一些泛型类型和类型变量。

`typing` 模块的类型注解更加灵活，使得我们能够更精确地表达函数的输入和输出类型，以及复杂数据结构的类型。

总的来说，基本类型注解是 `typing` 模块中类型注解的一部分，而 `typing` 模块提供了更广泛和更丰富的类型提示工具，可以满足更多复杂场景下的类型注解需求。



# 给类型定义别名

```
from typing import List
Vector = List[float]
# 这个就把Vector定义为List[float]的别名，表示一个内部是float类型的数组。

```

一般是用来组合类型里。

```python
from typing import Dict, Tuple, Sequence

ConnectionOptions = Dict[str, str]
Address = Tuple[str, int]
Server = Tuple[Address, ConnectionOptions]

```

# 用NewType定义一个自定义类型

```python
from typing import NewType

UserId = NewType('UserId', int)
```



这些类型只会在静态检查时有用。

运行时没有用。

# TypeVar泛型

`TypeVar` 是 `typing` 模块中的一个工具，

用于创建泛型类型变量。

泛型类型变量可以在函数、类等定义中作为参数，

用于表示类型的一种抽象，从而增加代码的灵活性和复用性。

下面是一个简单的示例，演示了如何使用 `TypeVar` 创建泛型类型变量：

```python
from typing import TypeVar, List

T = TypeVar('T')  # 创建一个名为 T 的泛型类型变量

def first_element(items: List[T]) -> T:
    return items[0]

# 在调用时指定具体的类型
result_str = first_element(["apple", "banana", "orange"])
print(result_str)  # 输出: apple

result_int = first_element([1, 2, 3, 4, 5])
print(result_int)  # 输出: 1
```

在这个例子中：
- 我们首先使用 `TypeVar` 创建了一个泛型类型变量 `T`。
- 然后，我们定义了一个函数 `first_element`，该函数接受一个列表 `items`，列表中的元素的类型被注解为泛型类型变量 `T`，并且函数的返回值类型也被注解为 `T`。
- 最后，我们分别调用了 `first_element` 函数两次，分别传入了一个字符串类型的列表和一个整数类型的列表，并且打印了函数的返回值。

通过使用 `TypeVar` 创建泛型类型变量，我们可以在函数定义中引入更加灵活的类型，使得函数能够处理不同类型的数据，并且在函数调用时根据具体的情况指定类型，从而增加了代码的通用性和复用性。



可以是任意类型

```
T = TypeVar('T')

def test(name: T) -> T:
	print(name)
	
test(11)
test('aa')
```

可以指定类型

```
T = TypeVar('T', int, str)
a:T = 1
a:T = 'aa'
a:T = [] # 这个就会报错。
```

# 相关的PEP

## 484

为了提供标准定义和工具，

本PEP引入了一个临时模块。

并且列出了一些不适用注解的情形的约定。

本PEP受到mypy的启发。

PEP 484 定义了类型注解的语法规则和约定，它并不要求在运行时进行类型检查，而是提供了一种静态类型检查的基础。通过类型注解，开发者可以在代码中明确指定变量和函数的期望类型，使得代码更加清晰和易于理解。

以下是 PEP 484 的一些主要内容：

1. 函数注解：使用 `->` 符号来标注函数的返回值类型，例如 `def func() -> int:`
2. 变量注解：使用冒号 `:` 后跟类型来标注变量的类型，例如 `x: int = 10`
3. 类型标注：使用 `typing` 模块中的类型来标注复杂类型，例如 `List[str]` 表示字符串列表
4. 类型别名：使用 `typing` 模块中的 `TypeVar` 来定义类型别名，例如 `MyType = Union[int, str]`
5. 可选类型注解：使用 `Optional` 表示可选类型，例如 `Optional[int]` 表示整数或者 `None`
6. 泛型类型：使用 `typing` 模块中的泛型类型来标注容器类型，例如 `List[int]` 表示整数列表

PEP 484 为 Python 提供了一种在代码中添加类型信息的方式，使得开发者可以更好地理解和维护代码。此外，它也为静态类型检查工具提供了基础，例如 `mypy` 等工具可以对代码进行类型检查，发现潜在的类型错误和逻辑问题。

https://peps.python.org/pep-0484/

https://www.cnblogs.com/popapa/p/PEP484.html

# 关于类型注解，我还有什么需要了解的

除了基本的类型注解和 `typing` 模块中的类型注解之外，还有一些相关的主题和技术值得深入了解，包括但不限于：

1. **类型注解的作用**：深入理解类型注解的目的和优势，包括提高代码的可读性、可维护性和可靠性，以及在静态类型检查工具中的应用。

2. **静态类型检查工具**：学习如何使用常见的静态类型检查工具，如 `mypy`、`pyright` 和 `pylint`，以及如何将它们集成到您的开发工作流程中。

3. **泛型类型和类型变量**：了解如何使用泛型类型和类型变量来处理参数化类型和抽象类型，从而增加代码的灵活性和通用性。

4. **协议（Protocols）**：学习如何使用协议来描述对象的接口和行为，从而实现静态类型检查的松散耦合和灵活性。

5. **类型别名**：探索如何使用类型别名来简化复杂类型的注解，提高代码的可读性和可维护性。

6. **类型注解与动态语言特性的结合**：了解如何在动态语言特性（如动态属性、元编程等）与类型注解之间取得平衡，以及如何在需要时放宽或加强类型注解的限制。

7. **社区实践和最佳实践**：参与社区讨论，了解其他开发者在实践中的经验和建议，从而更好地理解类型注解的应用和实践。

这些是深入学习和探索类型注解的一些方向，希望对您有所帮助！如果您有任何特定的问题或需求，欢迎随时向我提问。

# 类型注解的静态检查工具如何使用

使用类型注解的静态检查工具通常涉及以下步骤：

1. **安装静态检查工具**：首先，您需要安装您选择的静态检查工具，常见的工具包括 `mypy`、`pyright` 和 `pylint`。您可以使用 pip 工具来安装这些工具，例如：
   ```
   pip install mypy
   ```

2. **添加类型注解**：在您的 Python 代码中添加类型注解。这包括为函数参数、返回值和变量添加类型注解，以及使用 `typing` 模块中的类型注解工具描述更复杂的数据结构。

3. **运行静态检查工具**：运行所选的静态检查工具来检查您的代码中的类型注解是否符合规范，并且是否存在潜在的类型错误。您可以在命令行中运行这些工具，并指定要检查的 Python 文件或目录，例如：
   ```
   mypy your_code.py
   ```

4. **解决警告和错误**：根据静态检查工具的输出结果，解决代码中存在的类型错误、警告或建议。静态检查工具通常会生成详细的输出，指出代码中类型注解不符合规范或存在潜在的类型问题，您可以根据这些提示来修改代码并改进类型注解。

5. **集成到开发流程中**：将静态检查工具集成到您的开发流程中，例如在代码提交前自动运行静态检查工具来检查代码是否符合规范和类型注解的要求。这可以通过配置持续集成（CI）工具来实现，或者使用代码编辑器插件来实现实时检查。

通过使用静态检查工具，您可以更早地发现和修复代码中的类型错误，提高代码的可靠性和可维护性，并且在团队合作中更好地共享和理解代码。

## pycharm里集成的检查工具是什么

在 PyCharm 中集成了两种常用的静态类型检查工具：`mypy` 和 `pylint`。

1. **mypy**：
   `mypy` 是一个功能强大的静态类型检查工具，可以帮助您在代码编写阶段发现潜在的类型错误。PyCharm 支持集成 `mypy`，您可以在 PyCharm 中直接运行 `mypy` 并查看检查结果。如果您的项目中已经配置了 `mypy`，PyCharm 会自动识别并使用项目中的 `mypy` 配置。

2. **pylint**：
   `pylint` 是一个 Python 代码分析工具，可以检查代码中的语法错误、风格问题以及潜在的代码质量问题。虽然 `pylint` 不是专门针对类型注解的静态类型检查工具，但它也可以检查类型注解的正确性和一致性，并提供相应的警告和建议。

通过 PyCharm 中集成的这些静态检查工具，您可以在开发过程中实时地发现并解决代码中的问题，提高代码的质量和可维护性。您可以在 PyCharm 的设置中配置这些工具的使用方式，以及指定它们的配置文件和参数。

# 参考资料

1、

https://blog.csdn.net/jeffery0207/article/details/93734942

2、

https://blog.csdn.net/xiao_yi_xiao/article/details/122302445