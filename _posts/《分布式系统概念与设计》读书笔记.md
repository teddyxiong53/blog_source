---
title: 《分布式系统概念与设计》读书笔记
date: 2018-01-01 11:51:40
tags:
	- 分布式

---



这本书我要当成分布式入门的导航书，先精度这边，从里面的相关内容再发散，深入相关主题。

# 书籍基本信息

我阅读是中文第5版。写于2011年。

# 第1章 分布式系统的特征

## 定义

分布式系统是这样的系统：

1、组件分布在联网的计算机上。

2、组件之间通过消息进行通信和协调。

从这个定义，我们可以得到分布式系统的特征有：

1、组件的并发性。

2、缺乏全局时钟。

3、组件故障的独立性。

## 分布式系统的例子

1、大型多人在线游戏。简写为MMOG。MMOG工程体现了分布式技术面临的巨大挑战，尤其是响应时间的需求，只有这样才能保证良好的游戏体验。

2、金融交易系统。金融行业一直处于分布式系统技术的前言。



## 分布式系统的挑战



# 第12章 分布式文件系统

分布式文件系统让程序可以像访问本地文件一样访问远程文件。

典型就是sun开发的nfs。模拟了unix文件系统的接口。







# 第21章 分布式系统设计：Google实例研究



## 谷歌的总体结构和设计理念

### 物理模型

谷歌在物理基础设施方面的理念是：

用大量的商用PC来作为基础设施。

购买的原则是：

每一个美元可以获得最佳性能。

典型配置是：2TB的硬盘+16G内容，运行精简的Linux。

因为谷歌的最初版本就是搭建在实验室淘汰的电脑上的。

既然选择了这种方案，故障难以避免。这就需要谷歌设计一系列的策略来应对故障。

故障描述情况如下：

1、最常见的故障来源是软件。因为软件故障需要重启的机器大约有20台左右。这个重启要人来完成。

2、大约十分之一的硬件故障是软件导致的。每年大约有2%到3%的机器出现硬件故障。故障一般是硬盘或者内存坏了。

因为考虑到大部分的故障都是软件故障，所以就不值得投资更加昂贵的硬件设施。

谷歌按照下面的方式来构造物理基础设施：

1、每个机架安排40到80台商用pc。每个机架放一台以太网交换机。

2、机架被组织成集群，这个是一个管理单位。一个集群一般由30个机器和2个高带宽的交换机组成。2个交换机是为了备份。

3、机器被放置在世界各地的数据中心里。

所以就是三层架构：机架、集群、数据中心。

### 总的系统体系结构

先看一下对这个系统的述求有哪些。

1、可伸缩。

2、可靠性。不过搜索系统的故障很容易掩盖。

3、性能。

4、开放性。

基于上面这些述求，谷歌设计的总体设计是（从下到上）：

1、谷歌平台。就是上面的物理结构。

2、谷歌基础设施（中间件）。

3、谷歌应用和服务。

我们现在重点看一下谷歌基础设施。包括了下面内容：

1、底层通信范型。包括协议缓冲区、谷歌发布订阅服务（提供事件分发）。

2、数据和协调服务。包括GFS（一个分布式文件系统）、Chubby、BigTable（分布式数据库）。

3、分布式计算服务。包括MapReduce。

谷歌的设计原则有：

1、最重要的原则是简单。

2、性能。用毫秒来衡量。

3、通过日志和追踪来检测和解决系统故障。

### 底层通信范型

#### 协议缓冲区

基于简单原则，谷歌选用了远程调用服务这种方式。这种服务是RPC的变种。

java的rpc的序列化使用的是xml的。xml的冗余信息太多，不够高效。

所以谷歌选择自己开发一个简单且高效的序列化组件，就是协议缓冲区。这个是一个很基础的组件。代码是开源的。

协议缓冲区的消息格式是这样的：

```
后续补上。
```

谷歌声称，协议缓冲区的效率比xml方式要快10到100倍，要小3到10倍。

#### 发布订阅服务

这个是对协议缓冲区的补充。

发布订阅服务是为了：

1、实时可靠地把分布式事件推送给潜在的大量用户。

发布订阅服务的底层就是用协议缓冲区来做的。

谷歌对于这个服务的细节都没有透露。

是基于主题进行订阅（是否可以参考mqtt协议来帮助理解？）

### 数据和协调服务

#### 谷歌文件系统GFS

nfs也是属于分布式文件系统，是通用的。谷歌文件系统就是自己专用的。

gfs的设计考虑是：

1、必须可以可靠地运行在谷歌的分布式pc硬件上。

2、gfs针对谷歌应用的特点进行优化。相比于其他文件系统，gfs的文件数量不是很多，但是文件很大个。对文件的访问操作一般是大文件的顺序读取和文件追加的顺序写。

3、gfs必须满足谷歌基础设施的所有要求。可靠性、可伸缩、性能这些。

gfs的一个特点是把文件存储在固定大小的块里（每个块是64MB）。

#### Chubby

Chubby是个多面手。它可以干：

1、提供粗粒度的分布式锁。

2、提供一个文件系统，为小文件提供可靠存储（作为gfs的补充）。

3、做谷歌内部的名字服务。

#### BigTable

一个分布式存储系统。

### 分布式计算服务 

用的是MapReduce。



