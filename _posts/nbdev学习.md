---
title: nbdev学习
date: 2021-09-10 16:46:33
tags:
	- npu

---

--

**nbdev 系统适用于「探索式编程」（exploratory programming）**。

我们发现，大多数程序员将大部分工作时间用在探索和试验上。

比如我们会试验从未用过的新型 API，来理解其运作原理；

我们探索正在开发的算法的行为，以查看其处理不同数据类型的方式；

我们探索不同的输入组合，来调试代码……



我们认为探索流程是有价值的，应该保存下来，

以便其他程序员（或自己）在六个月时间之内能够看到发生了什么并通过示例学习。

把它看作科学期刊，你可以利用它展示自己尝试了什么东西（包括奏效的和无效的），和为了增强对工作系统的理解付出的努力。

在探索过程中，你会发现你理解到的某些部分对于系统运行非常关键，所以探索应包含测试和断言（tests and assertions）。

当你基于 prompt（或 REPL）开发，或者使用 notebook-oriented 开发系统（如 Jupyter Notebook）开发时，「探索」是最简单的。

但这些系统的「编程」部分没有那么强大。

这也是人们主要使用这类系统执行早期探索，然后转向 IDE 或文本编辑器的原因。

转而使用其他系统是为了获得 notebook 或 REPL 不具备的功能，

比如：优秀的文档查找功能、优秀的语法高亮功能、集成单元测试，以及（关键的）生成最终可分发源代码文件的能力。

nbdev 将 IDE/编辑器开发的优势带入 notebook 系统中，

以便用户在 notebook 中完成开发，且不会影响整个项目生命周期。

为支持此类探索，nbdev 基于 Jupyter Notebook 构建（这意味着，相比普通编辑器或 IDE，nbdev 能够更好地支持 Python 的动态特性），并针对软件开发添加了以下重要工具：

- 遵循最佳实践自动创建 Python 模块，如利用导出函数、类和变量自动定义` __all__`；
- 在标准文本编辑器或 IDE 中执行代码导航和编辑，并将所有更改自动导出回 notebook 中；
- 基于代码自动创建可搜索的超链接文档，引号中的任意单词均被超链接至合适的文档，文档站点的侧边栏可链接至每个模块等等；
- pip 安装包（上传到 PyPI）；
- 测试（在 notebook 中直接定义，可并行运行）；
- 持续集成；
- 版本控制和冲突处理。

如上图所示，用这种方式构建软件时，

项目团队中的所有成员均可以从你为理解问题域所做的工作中获益，

如文件格式、性能特点、API 边缘案例（edge case）等。

由于开发过程在 notebook 中进行，因此你还可以添加图表、文本、链接、图像、视频等，

**这些将被自动纳入库文档中。**

定义代码的单元格将被隐藏，并被标准化函数文档代替，

从而展示其名称、参数、文档字符串和源代码 GitHub 链接。

下文将介绍构建 nbdev 的原因以及 nbdev 设计原理背后的历史和背景。

首先，我们先来了解历史。（如果你对此不感兴趣，可以跳至「Jupyter Notebook 少了什么？」）

因此，你可以想象 Jupyter Notebook 诞生时我有多兴奋。

Jupyter Notebook 和 Mathematica 的基础 notebook 界面一样（尽管最初 Jupyter Notebook 的界面只有后者的一小部分功能），而且开源了，

这样我就可以使用广泛支持和免费可用的语言写代码。

我曾使用 Jupyter 探索算法、API 和新的研究想法，还把它作为 fast.ai 的教学工具。

很多学生发现它具备试验输入、查看中间结果和输出的能力，

且允许修改，从而帮助他们更完备、深刻地理解正在讨论的主题。

们还使用 Jupyter Notebook 写了一本书，这是一件很有趣的事。

基于 Jupyter Notebook，我们在书中结合了 prose、代码示例、层级结构化标题等，

同时保证样本输出（包含图表、表格和图像）完美匹配代码示例。



**Jupyter Notebook 少了什么？**

Jupyter Notebook 擅长「探索式编程」中的「探索」部分，但它不太擅长「编程」。例如，它没有提供执行以下操作的方式：

- 创建模块化可重用代码，这些代码可在 Jupyter 外部运行；
- 创建可搜索超链接文档；
- 测试代码（包括通过持续集成实现的自动化代码测试）；
- 代码导航；
- 版本控制。

我们认为处理这些冲突的最好方法是，利用现有的好用工具构建所需的功能。

例如，对于处理 pull request 和查看 diff，已经存在一个好用工具：ReviewNB。

当你在 ReviewNB 中查看图解版 diff 时，你会突然发现纯文本 diff 中的遗漏信息。

例如，如果某个 commit 使图像生成结果变得模糊不清，或者使图表没有标签该怎么办？

当你将这些 diff 视觉化呈现时，你会确切了解到底发生了什么。

nbdev 避免了很多合并冲突，因为它安装了 git hook，

从而首先去除引发冲突的部分元数据。

如果你执行 git pull 时出现合并冲突，只需运行 nbdev_fix_merge 即可。

运行该命令时，nbdev 只需使用输出存在冲突的单元格输出，

如果单元格输入存在冲突，那么最终 notebook 中会包含两个单元格以及冲突标记。

这样你就可以轻松找出它们，并在 Jupyter 中直接修复。

伴随着 nbdev 的开发，我们使用 nbdev 从头编写了 fastai v2。

fastai v2 为构建深度学习模型提供丰富、结构完善的 API，将于 2020 年上半年发布。

目前其功能完善，早期使用者已经使用预发布版本搭建了很酷的项目。

我们还在 fastai v2 中编写了其他项目，其中一些将在未来几周发布。

我们发现使用 nbdev 比使用传统编程工具的生产效率高 1-2 倍。

对我而言这是一个巨大的惊喜。

我已经写了 30 多年代码，试过几十个构建程序的工具、库和系统，

我原本没想到生产效率还有如此大的提升空间。

现在，我对未来感到振奋，我觉得开发者效率还有很大的提升空间，我期望看到人们用 nbdev 创建新的项目。





参考资料

1、

https://blog.csdn.net/weixin_41666747/article/details/104177510