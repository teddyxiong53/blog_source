---
title: 音频之i2s协议
date: 2021-12-10 13:20:25
tags:
	- 音频

---

--

I2S(Inter—IC Sound)总线, 又称 集成电路内置音频总线，

是飞利浦公司为数字音频设备之间的音频数据传输而制定的一种总线标准，

该总线专门用于音频设备之间的数据传输，广泛应用于各种多媒体系统。

它采用了沿独立的导线传输时钟与数据信号的设计，

**通过将数据和时钟信号分离，**

**避免了因时差诱发的失真，**

为用户节省了购买抵抗音频抖动的专业设备的费用。 



1、支持全双工/半双工

2、支持主/从模式

3、和PCM相比，I2S更适合立体声系统。

**当然，I2S的变体也支持多通道的时分复用，因此可以支持多声道。**



I2S主要有三个信号

1、串行始终SCLK，也叫位始终（BCLK），对应数字音频的每一位数据，SCLK都有一个脉冲。SCLK的频率=2 * 采样频率 * 采样位深。

2、帧时钟LRCK（也称WS），用于切换左右声道的数据。LRCK为‘1’表示传输右声道数据，为“0”则是左声道。LRCK的频率 = 采样频率

3、串行数据（SDATA），就是用二进制补码表示的音频数据，（MSB ---> LSB：数据由高位到低位依次传输）

**4、一般还有MCLK，主时钟。** 



随着技术的发展，也出现了很多种不同的数据格式。

根据data相对于LRCK和SCLK位置的不同，

分为I2S标准格式（飞利浦规定的格式），

左对齐（较少使用）

和右对齐（日本格式，普通格式），

**发送和接收端必须使用相同的数据格式。** 



这里有Great Scott的视频讲解。

https://www.bilibili.com/video/BV1Pt4y1X7M1



那么我们知道I2S是有一个LRCLK(帧时钟,用来切换左右声道的, 看上去只能处理两个声道咯?).
那么4个声道得怎么处理呢? 是用到两路I2S么?
那如果是用到两路I2S, 是不是需要把4声道的数据分成两部分来传输, 前4个字节(左前, 右前)用I2S1来传输, 后4个字节(左后, 右后)用I2S2来传输?



I2S数据可以合并在一起传，比如我们用的AD芯片TW2867，输出就是4路音频合并在一起的，还可以串接4片，16路音频在一个I2S信号里传，不过总的bit位需要合乎I2S协议的规定，好像是256bit。我搞硬件的，软件不是很确定。



为了保证数字音频信号的正确传输，发送端和接收端应该采用相同的数据格式和长度。当然，对I2S格式来说数据长度可以不同。



**在IIS总线中，任何设备都可以通过提供必需的时钟信号成为系统的主设备置，**

而从属设备通过外部时钟信号来得到它的内部时钟信号，

这就意味着必须重视主设备和数据以及命令选择信号之间的传播延迟，

总的延迟主要由两部分组成：

1.外部时钟和从设备的内部时钟之间的延迟
2.内部时钟和数据信号以及命令选择信号之间的延迟



skew表示偏斜。

![image-20220111103004982](https://gitee.com/teddyxiong53/playopenwrt_pic/raw/master/image-20220111103004982.png)





4，I2S初始化配置
①，i2s的时钟使能和GPIO口配置
②，配置为i2s模式
③，i2s标准，包括**左对齐，右对齐，i2s标准**，即数据的最高位总是出现在WS变化（也就是一帧开始）后的第2个CK脉冲处。
④，i2s数据长度，包括16位，16位扩展（16位数据以32位包发送），24位，32位。
⑤，设置i2s时钟
⑥，设置i2s空闲状态下时钟电平
⑦，i2s使能
⑨，设置I2S的采样率。采样率一般在8K-192K之间。

5，I2S读写数据流程
①，WS时钟线用于切换左右声道，在该时钟的同一周期内的高电平和低电平应发送相同的数据，然后左右声道的声音才会一样。
②，CK时钟用于启动传输每一位音频数据



6，单声道音频数据转双声道音频数据
把单声道数据转换成双声道数据传输时，可作如下数据转换：
for(res=0;res<DATA_LEN;res++)
{
buf2[res*4]=buf1[res*2];
buf2[res*4+1]=buf1[res*2+1];
buf2[res*4+2]=buf1[res*2];
buf2[res*4+3]=buf1[res*2+1];  
}  

# 参考资料

1、【音频】I2S协议详解

https://www.bilibili.com/read/cv7248991

2、**4声道数据如何在I2S上传输? 是否需要用到2个I2S?** 

https://www.amobbs.com/thread-5493228-1-1.html

3、

https://zhuanlan.zhihu.com/p/38330995

4、

https://www.cnblogs.com/linhaostudy/p/7700287.html

5、I2S通信详解

https://blog.csdn.net/qzl1221/article/details/77499684