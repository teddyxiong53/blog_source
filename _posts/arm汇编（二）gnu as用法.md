---
title: arm汇编（二）
date: 2018-02-02 12:35:23
tags:
	- arm

---



鉴于我对汇编也不是一无所知，我决定采取的方式是，从gnu as的入手。先把汇编器理顺。

先理一个大概，后续不断完善这篇文章。

as默认的用来给gcc输出s文件来做汇编的。目标是给到ld用。

gcc 到as 到ld。输出可执行文件。

#as的选项

## 通用选项

暂时觉得没有特别值得注意的。

## arm相关选项

```
-mpu=xxx
-march=xxx
-mfpu=xxx
-mfloat-abi=xxx
-meabi=version
-mthumb
```





# 语法

这个重点看。

as来自于BSD4.2的assembler。所以as跟其他的汇编器很相似。

## 1.预处理

预处理做了这些事：

1、调整空白字符。最后达到的效果是：每行前面一个tab或者一个空格。其他空白都变成一个空格。

2、取出所有注释，用一个空格替换。

3、把字符常量替换为立即数。

没有做宏处理。

## 2.注释

和C语言的一样。

## 3.符号命名

1、大小写铭感。

2、没有长度限制。

3、宽字符是允许的。

## 4.语句

允许空语句。

## 5.常量

字母常量、字符串、数字常量。

```
.byte 1,02,0x03,'a' 
.ascii "hello\n"
.octa 0x123456789abcdefg123456789abcdefg //很大的数也允许。
```



# section和relocation

简单说，一个section就是一组地址，中间没有空隙。**在这些地址里的数据，有某种相同的特性，例如只读。**

**ld读取多个o文件，组装成一个可执行文件。**

as生成一个o文件，这部分的位置就是假定在地址0的位置。要保证多个o文件不要相互覆盖。

给section分配运行时的地址，这个操作叫relocation。

**一个o文件有3个section：text、data、bss。当然还有其他的section。但是不重要。**



# 伪指令

所有伪指令用点号开头。大小写敏感，大部分的小写的。

下面描述的时候，处于简单考虑，把前面的点号都省略了。

1、abort。马上停止汇编。这个是历史遗留。

2、align x, y, z

3、ascii 和asciz，asciz定义的字符串跟C语言的应用，有个'\0'结尾。

4、byte。放一些字节数据在这里。

太多，不看了。后续碰到再查阅。





.syntax unified 是一个指示，说明下面的指令是ARM和THUMB通用格式的





参考资料

1、ARM Cortex-M3与Cortex-M4权威指南











