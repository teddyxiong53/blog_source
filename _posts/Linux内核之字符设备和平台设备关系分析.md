---
title: Linux内核之字符设备和平台设备关系分析
date: 2019-12-11 11:09:38
tags:
	- Linux

---

1

平台设备和字符设备关系
sysfs下面，有3个重要目录：
devices、bus、class。
devices下面是一个个的设备。
bus和class很多都是指向devices下面的软链接。
class是对devices的设备进行分类。

如果没有设备模型，应用层很难知道driver和device的关系。
因为字符设备没有提供这些信息。
这就导致driver的管理者很难处理。

事实上，class、device、device_driver不会把所有的信息暴露给用户层。
它们都有private数据。用于链表关系维护。
如果把这个信息也暴露给用户层，那么容易被用户层修改导致系统混乱。

实际上，用户层只关心三者的视图关联，对于底层不关系。

设备驱动模型提供了电源管理机制。
我们在字符设备的file_operations里看不到电源管理的接口。

对于os来说，电源管理必不可少。
电源管理不应该由应用开发者来关注。
应该由系统来负责。
例如，手机在一段时间后进入休眠状态。这个应该是系统来完成。

设备驱动模型和字符设备驱动的区别
设备驱动模型：
	关注对bus、device和driver的管理。
	并向应用层暴露这些管理信息。
字符设备驱动：
	关注设备驱动功能的实现。



s3c2410中的看门狗驱动，它既是字符设备驱动，也是杂项设备驱动，同时还是平台设备驱动：

字符设备描述了：

​	看门狗的访问方式是串行的、顺序的，而不是随机的、缓冲的。

misc设备则意味着：

​	主设备号是misc的。

平台设备表示；

​	看门狗这个设备属于平台的独立模块。它完全是一项附加信息。

对于看门狗而言：

​	字符设备是它的本质。

​	混杂设备则是这个字符设备的容器。

​	平台设备则描述了看门狗的一种属性。

一般是把字符设备包装成一个平台设备。

在平台设备的probe函数里，进行字符设备的注册。



参考资料

1、字符设备驱动、平台设备驱动、设备驱动模型、sysfs的比较和关联

https://www.cnblogs.com/jiandahao/p/5893271.html

2、Linux驱动之平台设备（张栖银详谈）

https://wenku.baidu.com/view/b2635e437f1922791788e816.html