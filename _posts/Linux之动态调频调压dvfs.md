---
title: Linux之动态调频调压dvfs
date: 2023-08-25 17:11:33
tags:
	- Linux

---

--

# linux动态调频调压

在Linux系统中，动态调频（Dynamic Frequency Scaling，也称为CPU调频）和动态调压（Dynamic Voltage and Frequency Scaling，DVFS）是一种能够在运行时自动调整处理器的频率和电压以节省能量和降低发热的技术。这些技术通过降低处理器的工作频率和电压来降低功耗，从而在不影响性能的情况下延长设备的电池寿命或减少功耗。

以下是在Linux系统中实施动态调频和动态调压的一般步骤：

1. **CPU调频设置**：
   
   - **查看可用的调频器**：首先，您可以使用`cpufreq-info`命令或查看`/sys/devices/system/cpu/cpufreq`目录来查看可用的CPU调频器。
   
   - **选择调频器**：根据您的硬件和需求，选择一个适当的CPU调频器。常见的调频器包括"ondemand"、"powersave"、"performance"等。
   
   - **设置调频器策略**：使用`cpufreq-set`或`cpupower`等工具来设置所选调频器的策略。例如，可以将处理器设置为"powersave"模式以降低功耗，或设置为"performance"模式以提高性能。

2. **CPU调压设置**：
   
   - **使用CPU调频器**：大多数CPU调频器通常会自动管理电压和频率，但您可以使用`cpupower`等工具来手动调整电压和频率。

3. **监控性能和功耗**：
   
   - **监控工具**：使用工具如`cpufreq-info`、`cpupower`、`powertop`、`turbostat`等来监控处理器的性能、频率、电压和功耗。

4. **自动化策略**：
   - **使用守护进程或脚本**：您可以编写自定义脚本或使用守护进程来动态调整CPU频率和电压，以根据负载、电池状态等因素进行优化。

需要注意的是，动态调频和动态调压可以根据系统配置和硬件支持程度而异。不同的处理器、主板和内核版本可能会有不同的设置和工具。因此，在配置这些功能时，请查看您的系统的文档和相关资源以确保正确设置。

此外，动态调频和调压可以在不同的场景中产生不同的效果。在移动设备和笔记本电脑中，它们通常用于延长电池寿命。在服务器环境中，它们可以帮助节省能源和降低运行成本。因此，在配置这些功能时，请根据您的应用场景和需求进行优化。

# linux dvfs 软件架构

Linux中的DVFS（Dynamic Voltage and Frequency Scaling）是一种能够在运行时动态调整处理器的频率和电压以节省能量和降低发热的技术。DVFS的软件架构涉及多个组件和子系统，以确保有效地管理CPU频率和电压。以下是Linux DVFS的一般软件架构：

1. **CPUfreq驱动程序**：CPUfreq是Linux内核中的一个子系统，负责管理处理器的频率和电压。它包括以下关键组件：

   - **Governors（调频器）**：Governors是CPUfreq的一部分，它们是用于管理处理器频率和电压的策略模块。常见的调频器包括"ondemand"、"conservative"、"powersave"、"performance"等。每个调频器都有自己的策略，用于在不同的负载情况下调整频率和电压。

   - **调频器接口**：CPUfreq提供了与CPUfreq调频器交互的接口，允许用户和应用程序设置和查询处理器频率和电压。

2. **CPUidle驱动程序**：CPUidle是另一个Linux内核子系统，用于在处理器处于空闲状态时降低功耗。它通过将处理器置于低功耗状态（例如深度睡眠状态）来实现节能。CPUidle通常与CPUfreq协同工作，以实现全面的能量节省。

3. **ACPI（高级配置与电源接口）**：ACPI是一种电源管理标准，它定义了一种用于配置和管理电源状态的接口。Linux使用ACPI来与硬件通信，以便在DVFS操作中获取有关电源状态的信息，如电池状态、充电状态等。

4. **电源管理守护进程**：在Linux系统中，通常有一些电源管理守护进程（如`powernowd`、`cpufreqd`等）可以根据系统的电源需求和策略来调整CPU频率和电压。这些守护进程可以根据需要调用CPUfreq驱动程序以实现DVFS。

5. **性能监测工具**：性能监测工具（如`cpufreq-info`、`cpupower`、`powertop`等）用于监控CPU频率、电压和功耗，以及调查DVFS的效果。

总之，Linux DVFS的软件架构是一个多组件的系统，涉及内核中的CPUfreq和CPUidle子系统、ACPI、电源管理守护进程以及性能监测工具等。这些组件共同协作，以在运行时有效地管理处理器的频率和电压，以实现能源节省和热管理。不同的Linux发行版和硬件架构可能会有略微不同的DVFS实现方式。

# 怎样学习相关的开发技术呢

学习Linux的开发技术，特别是与DVFS（Dynamic Voltage and Frequency Scaling）相关的技术，需要采取一系列步骤和方法。这些技术通常需要深入了解Linux内核和相关工具，以下是学习这些技术的一些建议：

1. **建立Linux基础**：
   - 了解Linux操作系统的基本原理，包括进程管理、文件系统、内存管理等。
   - 熟悉Linux命令行界面，学会使用常见的命令。

2. **学习Linux内核**：
   - 了解Linux内核的基本结构和组件，包括进程调度、中断处理、设备驱动程序等。
   - 学习如何编译和配置Linux内核。

3. **熟悉CPUfreq和CPUidle**：
   - 深入了解Linux内核中的CPUfreq和CPUidle子系统，以及它们在处理器功耗管理中的作用。
   - 研究不同的CPUfreq调频器（Governors）和CPUidle驱动程序，了解它们的工作原理和配置方式。

4. **学习ACPI**：
   - 了解高级配置与电源接口（ACPI），包括其在电源管理中的角色和使用方法。
   - 学习如何通过ACPI与硬件交互以获取电源状态信息。

5. **掌握电源管理守护进程**：
   - 学习电源管理守护进程的使用，这些守护进程可用于自动化DVFS操作。
   - 掌握相关配置文件和策略。

6. **使用性能监测工具**：
   - 使用性能监测工具（如`cpufreq-info`、`cpupower`、`powertop`）来监控系统的性能、功耗和电压。
   - 研究工具的输出以评估DVFS策略的有效性。

7. **开发实际应用**：
   - 尝试编写简单的应用程序或脚本，以手动控制DVFS，以更好地理解它们的工作原理。
   - 在实际项目中应用DVFS技术，以实现能源节省或热管理。

8. **阅读文档和参考资料**：
   - 查看Linux内核文档、ACPI规范和相关工具的文档以获取深入的知识。
   - 探索Linux社区和论坛，查找有关DVFS的讨论和教程。

9. **参与社区和项目**：
   - 参与开源项目或社区，特别是与Linux电源管理和DVFS相关的项目。
   - 通过与其他开发者互动，分享知识和经验。

10. **不断实践和调试**：
    - 实践是学习的关键。尝试不同的设置和配置，观察其影响，通过调试和错误排查来深入了解DVFS技术。

学习Linux开发技术需要时间和耐心，因为这是一个复杂而广泛的领域。逐步学习，逐渐深入，同时不断探索和实践，将有助于您掌握相关技术。

# CPUfreq 介绍

CPUfreq（CPU Frequency Scaling）是一种在Linux操作系统中用于管理和调整处理器（CPU）频率的技术。它的目标是根据系统负载、功耗需求和性能要求来动态调整CPU的工作频率，以实现能源节省、降低发热和延长电池寿命。以下是有关CPUfreq的一些重要信息：

1. **动态频率调整**：CPUfreq允许系统根据当前工作负载的需求来动态地调整CPU的工作频率。当系统负载较低时，CPU可以降低频率以降低功耗和发热；当需要更高性能时，CPU可以提高频率以提供更多计算能力。

2. **Governors（调频器）**：CPUfreq使用称为"Governors"的策略模块来管理CPU的频率。每个Governor都有自己的调频策略，可以根据不同的需求选择最佳频率。常见的Governors包括：
   - **ondemand**：根据负载动态调整频率，适用于节能。
   - **conservative**：逐渐降低频率以响应降低负载，适用于节能。
   - **performance**：将CPU保持在最高频率，以提供最佳性能。
   - **powersave**：将CPU保持在最低频率，以最大程度地节省能源。

3. **用户空间接口**：CPUfreq提供了用户空间接口，允许用户和应用程序查询和配置CPU频率。您可以使用命令行工具（如`cpufreq-info`、`cpufreq-set`）或编程接口来与CPUfreq交互。

4. **硬件支持**：CPUfreq的功能需要硬件支持，因为不是所有处理器都支持动态频率调整。大多数现代处理器都支持DVFS（Dynamic Voltage and Frequency Scaling），这是CPUfreq的一种形式。

5. **电池寿命和发热管理**：CPUfreq在移动设备和笔记本电脑上常用于延长电池寿命。它还在服务器和数据中心环境中用于发热管理，以确保CPU在高负载时不过热。

6. **性能监测工具**：Linux提供了性能监测工具（如`cpupower`、`powertop`）来监控CPUfreq的性能和功耗情况。这些工具可用于评估DVFS策略的有效性。

总之，CPUfreq是Linux中用于管理和调整CPU频率的技术，通过动态调整CPU的工作频率来实现能源节省、发热管理和性能优化。不同的Governors允许用户根据需求选择最佳的频率策略。这些功能在各种设备和场景中都有用途，从移动设备到服务器都可以受益于CPUfreq的使用。



```
sudo apt install cpufrequtils
```

# CPUidle子系统

CPUidle子系统是Linux内核中的一个组件，用于在处理器（CPU）处于空闲状态时降低功耗。其主要目标是最大程度地减少CPU的能源消耗，从而延长设备的电池寿命或降低系统的总功耗。

以下是有关CPUidle子系统的一些重要信息：

1. **CPU空闲状态**：当CPU处于空闲状态时，它通常会继续运行，但没有要执行的任务。在这种情况下，CPU消耗的功耗仍然存在，尽管工作负载很低。

2. **CPUidle工作原理**：CPUidle子系统通过将CPU置于不同的低功耗状态来降低功耗。这些低功耗状态通常包括C-states（C0、C1、C2等）和P-states，它们具有不同的功耗和响应时间。C-states通常是硬件定义的，而P-states通常是由操作系统控制的。

3. **Governors（调度器）**：CPUidle子系统使用称为"Governors"的策略模块来选择最佳的CPU空闲状态。这些Governors会根据系统的负载、电池状态和性能需求来决定将CPU置于哪个状态。常见的Governors包括"menu"、"ladder"、"teo"等。

4. **用户空间接口**：CPUidle提供了用户空间接口，允许用户和应用程序查询和配置CPU的空闲状态。您可以使用`cpuidle-info`等命令行工具或编程接口来与CPUidle交互。

5. **电源管理守护进程**：在Linux系统中，通常有一些电源管理守护进程（如`powernowd`、`cpufreqd`等）可以根据系统的电源需求和策略来调整CPU空闲状态，以实现节能。

6. **硬件支持**：CPUidle的功能需要硬件支持，因为不是所有处理器都支持C-states和P-states。大多数现代处理器都支持这些功能，但具体支持的状态和策略可能因处理器型号而异。

7. **电池寿命和发热管理**：CPUidle在移动设备和笔记本电脑上常用于延长电池寿命。它还在服务器和数据中心环境中用于发热管理，以确保CPU在空闲时不过热。

总之，CPUidle子系统是Linux内核的一部分，用于管理处理器的空闲状态，以降低功耗并延长设备的电池寿命。它是Linux能源管理的重要组成部分，有助于在不影响性能的情况下实现能源节省。不同的Governors允许用户根据需求选择最佳的功耗策略。这些功能在各种设备和场景中都有用途，从移动设备到服务器都可以受益于CPUidle的使用。