---
title: 汇编调用C语言函数设置栈
date: 2020-07-23 10:33:51
tags:
	- 汇编

---

--

一直以来我们都是在用汇编代码在写程序

那么怎样才能用C语言来写程序，以及如何去调用呢？

这就不得不提及“C语言运行时”，英文叫做runtime，这些环境条件，有汇编来提供，

主要是设置栈，栈是C语言中的一种[数据结构](https://so.csdn.net/so/search?q=数据结构&spm=1001.2101.3001.7020)，局部变量都是由栈来实现的，

要注意的是为C语言设置栈简单，但是指定的栈空间要合理合法。



以前我们可能脑袋中就没有这种意识，我还要自己设置栈啊，那是因为很多工作别人帮我们做好了。

**比如gcc在编译完链接的时候，会帮我们自己添加一个头，**

**这个头是引导我们的C程序能够执行的一段汇编实现的代码，**

**这段代码就帮助我们的C程序设置了栈以及其它的运行时。**



CPU模式和各种模式下的栈

栈，SP指针指向的位置，

在ARM中，有6个SP，好几个模式都有自己的SP（r13）

**如果只有一个栈，应用程序出错，就会使得操作系统的栈也损坏。**



所以设置栈，就涉及两个方面，一个是模式，其次才是设置合理的栈，

我们现在因为就是在SVC模式下，所以模式问题就解决了，

**栈必须是当前一段可以使用的内存（注意当前CPU刚复位）**

可用的意思是这个地方必须有被初始化可以访问的内存，

而且这个内存只会被我们用做栈，

**所以目前只好用SRAM中的内存来初始化SVC模式下的栈。**





参考资料

1、汇编写启动代码之设置栈和调用C语言1

https://blog.csdn.net/qq_18973645/article/details/50994937

