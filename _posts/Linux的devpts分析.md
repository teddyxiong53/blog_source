```
title: Linux的devpts分析
date: 2017-05-02 19:43:35
tags:
- devpts
```

在构建rootfs的时候，经常看到devpts这个东西，其具体含是什么呢？
一般我们在Linux下看到的控制台，是由多个设备来共同实现的。分别是`/dev/ttyN`（tty0对应console设备，tty1和tty2对应的就是虚拟的console了），我们可以用Alt+Fn来在这些console之间切换。
而`/dev/pts`是给远程登录（包括telnet和ssh等）后所创建的目录，这个目录下放的是控制台设备文件。因为远程登录的数量是难以预先知道的，所以`/dev/pts`其实是动态生成的。

pts是pseudo terminal slave的意思，对应的是ptmx（master）。它们一起构成了pty（虚拟终端）。

```
echo "xhl" > /dev/console
```

这可以得到跟`echo "xhl"`一样的效果。

`echo "xhl" > /dev/tty`也是一样的效果。

如何看到当前自己使用的是哪个tty呢？

用tty命令就行，如下：

```
teddy@teddy-ubuntu:/dev/pts$ echo "xhl" > /dev/pts/0
teddy@teddy-ubuntu:/dev/pts$ tty
/dev/pts/6
teddy@teddy-ubuntu:/dev/pts$ echo "xhl" > /dev/pts/6
xhl
```



# devpts 介绍

devpts 是一个特殊的虚拟文件系统，用于在 Linux 系统中提供伪终端（pseudo terminal）功能。伪终端是一种软件设备，允许用户与另一个程序进行交互，就像在物理终端上一样。这在许多情况下非常有用，例如在远程登录会话、终端仿真器和虚拟机中。

在 Linux 系统中，devpts 文件系统通常被挂载在 /dev/pts 目录下。它的主要作用是创建和管理伪终端设备节点。当用户在系统上启动一个新的终端会话时，devpts 文件系统会分配一个新的设备节点，并将其与该会话关联起来。这个设备节点通常以 /dev/pts/X 的形式出现，其中 X 是一个数字，代表伪终端的编号。

通过使用伪终端，可以实现许多功能。例如，远程登录会话（如 SSH）可以使用伪终端来提供交互式的终端环境。终端仿真器（如 GNOME Terminal 或 Konsole）可以使用伪终端来模拟物理终端，并允许用户在图形界面中执行命令。虚拟机管理程序（如 VirtualBox 或 VMware）可以使用伪终端来与虚拟机实例进行通信。

总之，devpts 是一个重要的虚拟文件系统，用于创建和管理 Linux 系统中的伪终端设备节点，以提供交互式终端环境。它在各种应用程序中发挥着关键的作用，使用户能够与系统和其他程序进行交互。

# devpts 发展历史

devpts 的发展历史可以追溯到 1996 年。在早期的 Linux 内核版本中，终端设备节点（如 /dev/tty1、/dev/tty2 等）是通过静态分配的方式创建的。这意味着每个终端都需要在内核编译时预先定义。

然而，这种静态分配的方式存在一些问题。首先，终端数量是有限的，这限制了系统中可以同时打开的终端会话的数量。其次，这种静态分配方式在系统启动时就分配了所有终端设备节点，即使在实际使用中只有一小部分被使用到，也会浪费资源。

为了解决这些问题，devpts 文件系统被引入到 Linux 内核中。最早的 devpts 实现称为 devfs（设备文件系统），它于 1999 年首次出现在 Linux 内核 2.3.46 版本中。devfs 在内核中使用一个动态分配的设备节点表，可以根据需要创建和删除设备节点。

然而，由于 devfs 的实现存在一些问题，比如性能瓶颈和安全性漏洞，它在后来的内核版本中被 devpts 替代。devpts 首次出现在 Linux 内核 2.4.0 版本中，并成为默认的终端设备节点管理方式。

devpts 使用一个虚拟文件系统，将终端设备节点的创建和管理交给用户空间的进程。它提供了更好的性能和可扩展性，支持大量的终端会话，并且只在需要时动态分配设备节点，节约了系统资源。

随着时间的推移，devpts 继续进行改进和优化，以适应不断变化的需求。它成为 Linux 系统中管理伪终端的标准方式，并被广泛应用于各种应用程序和工具中。

总结起来，devpts 的发展历史可以追溯到 devfs，最早出现在 Linux 内核 2.3.46 版本中。后来，在 Linux 内核 2.4.0 版本中，devfs 被 devpts 替代，并成为默认的终端设备节点管理方式。devpts 提供了更好的性能、可扩展性和资源管理，成为 Linux 系统中管理伪终端的标准方式。