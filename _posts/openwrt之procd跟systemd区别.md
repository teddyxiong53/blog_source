---
title: openwrt之procd跟systemd区别
date: 2022-08-18 14:27:33
tags:
	- Linux

---

--

# 跟systemd区别

`procd` 和 `systemd` 都是用于管理 Linux 系统中的进程和服务的工具，但它们在设计和使用上有一些区别。以下是它们之间的主要区别：

1. **设计哲学和目标：**
   - `procd`：`procd` 是 OpenWrt 中使用的一种轻量级的进程管理器。它专注于在嵌入式系统中提供一种简单而有效的进程管理方式。`procd` 的设计旨在保持系统的轻量性，以适应资源受限的嵌入式设备。
   - `systemd`：`systemd` 是现代 Linux 系统中广泛使用的初始化系统和服务管理器。它具有强大的功能，可以同时管理进程、服务、挂载点、定时任务等。`systemd` 的目标是提供更加全面和集成的系统管理工具。

2. **功能和特性：**
   - `procd`：虽然 `procd` 的功能相对较少，但它足够用于嵌入式系统中的进程管理。它可以管理系统的 init 进程、提供进程的启动和停止、监控网络和设备接口等。
   - `systemd`：`systemd` 提供了更多的功能，包括并行启动、依赖解决、服务状态监控、日志记录、定时任务等。它还引入了一种单元文件（unit files）的配置方式，用于定义系统和服务的各种属性和行为。

3. **配置方式：**
   - `procd`：`procd` 使用类似于 OpenWrt 风格的脚本配置文件，较为简单和直观。
   - `systemd`：`systemd` 使用单元文件（unit files）来配置系统服务和其他单位。这些文件以 `.service`、`.target`、`.timer` 等后缀结尾，具有更加结构化和灵活的配置方式。

4. **系统支持：**
   - `procd`：`procd` 主要用于嵌入式设备和 OpenWrt 等系统中。
   - `systemd`：`systemd` 是现代 Linux 发行版的标准初始化系统和服务管理器，被广泛支持和使用。

总的来说，`procd` 更适合嵌入式设备和轻量级系统，而 `systemd` 则适用于更大、更复杂的系统，提供了更多的功能和灵活性。选择使用哪个取决于系统的需求和特点。

# procd代码分析

`procd` 是 OpenWrt 中使用的进程管理工具，负责启动、停止和监控系统中的各种进程。`procd` 的代码比较复杂，涉及到许多细节和功能。在这里，我将为你提供一个大致的代码分析框架，以帮助你理解 `procd` 的工作原理。

`procd` 的代码分析可以分为以下几个主要方面：

1. **初始化和主循环：** `procd` 的入口点是 `main.c` 文件。它负责初始化 `procd` 的各种模块、数据结构和配置。主循环部分负责不断地处理系统中的事件和任务，如启动、停止进程，处理信号等。

2. **数据结构和配置：** `procd` 使用多种数据结构来存储进程和服务的信息，例如链表、哈希表等。配置文件和默认设置也在此部分处理，以确定如何管理进程和服务。

3. **进程管理模块：** `procd` 的进程管理模块负责实际的进程管理操作，包括启动、停止、重启等。它还处理进程的状态监控，以确保进程的正常运行。

4. **信号处理和事件驱动：** `procd` 通过捕获信号和监听文件描述符等方式来处理系统事件。这些事件可以触发进程的启动、停止等操作。

5. **日志记录和输出：** `procd` 会记录各种事件和操作的日志，以便用户和开发者进行故障排除和监控。

6. **模块化设计：** `procd` 的代码使用模块化的设计，各个模块负责不同的功能。例如，`service.c` 模块负责服务管理，`run.c` 模块负责运行脚本等。

7. **定时任务和定时器：** `procd` 可能需要在一些情况下执行定时任务，如定时重启等。这部分涉及到定时器的管理和调度。

8. **与其他 OpenWrt 组件的交互：** `procd` 可能会与其他 OpenWrt 组件（如网络、系统初始化等）进行交互，以确保系统的正常运行。

由于 `procd` 的代码相当庞大且涉及多个模块，对其整个代码的详细分析超出了本回答的范围。如果你想深入了解 `procd` 的内部工作原理，我建议你阅读其源代码，从 `main.c` 开始，逐步深入各个模块。在阅读代码的过程中，你可能还需要参考 `procd` 的文档和注释，以便更好地理解其功能和设计。